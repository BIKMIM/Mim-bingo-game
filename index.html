<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ˆì£¼ë¨¸ë‹ˆ ë¹™ê³  ê²Œì„</title>
    <style>
        // ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” */
        * {
            [cite_start]margin: 0; [cite: 1]
            [cite_start]padding: 0; [cite: 2]
            [cite_start]box-sizing: border-box; [cite: 2]
        }

        // ì „ì²´ í˜ì´ì§€ ë°°ê²½ ë° í°íŠ¸ */
        body {
            [cite_start]font-family: Arial, sans-serif; [cite: 2]
            [cite_start]background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); [cite: 3]
            [cite_start]min-height: 100vh; [cite: 3]
            [cite_start]padding: 20px; [cite: 3]
            [cite_start]display: flex; [cite: 3]
            [cite_start]flex-direction: column; [cite: 3]
            [cite_start]align-items: center; [cite: 3]
            [cite_start]justify-content: center; [cite: 3]
        [cite_start]} [cite: 4]

        // ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            [cite_start]max-width: 1200px; [cite: 4]
            [cite_start]width: 100%; [cite: 5]
            [cite_start]margin: 0 auto; [cite: 5]
            [cite_start]background: white; [cite: 5]
            [cite_start]border-radius: 15px; [cite: 5]
            [cite_start]box-shadow: 0 10px 30px rgba(0,0,0,0.3); [cite: 5]
            [cite_start]overflow: hidden; [cite: 5]
        [cite_start]} [cite: 6]

        // í—¤ë” */
        .header {
            [cite_start]background: #4a5568; [cite: 6]
            [cite_start]color: white; [cite: 7]
            [cite_start]padding: 20px; [cite: 7]
            [cite_start]text-align: center; [cite: 7]
        }

        // ê²Œì„ ì„¤ì • ì„¹ì…˜ */
        .game-setup {
            [cite_start]padding: 30px; [cite: 7]
            [cite_start]border-bottom: 2px solid #e2e8f0; [cite: 8]
        }

        // ë°© ê´€ë ¨ ì„¹ì…˜ */
        .room-section {
            [cite_start]margin-bottom: 30px; [cite: 8]
        }

        // ì…ë ¥ ê·¸ë£¹ (ë¼ë²¨ + ì¸í’‹) */
        .input-group {
            [cite_start]margin-bottom: 15px; [cite: 9]
        }

        .input-group label {
            [cite_start]display: block; [cite: 10]
            [cite_start]margin-bottom: 5px; [cite: 11]
            [cite_start]font-weight: bold; [cite: 11]
            [cite_start]color: #4a5568; [cite: 11]
        }

        .input-group input, .input-group select {
            [cite_start]width: 100%; [cite: 11]
            [cite_start]padding: 12px; [cite: 12]
            [cite_start]border: 2px solid #e2e8f0; [cite: 12]
            [cite_start]border-radius: 8px; [cite: 12]
            [cite_start]font-size: 16px; [cite: 12]
        [cite_start]} [cite: 13]

        .input-group input:focus, .input-group select:focus {
            [cite_start]outline: none; [cite: 13]
            [cite_start]border-color: #667eea; [cite: 14]
        }

        // ë²„íŠ¼ ê·¸ë£¹ */
        .button-group {
            [cite_start]display: flex; [cite: 14]
            [cite_start]gap: 10px; [cite: 15]
            [cite_start]flex-wrap: wrap; [cite: 15]
        }

        // ì¼ë°˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            [cite_start]padding: 12px 24px; [cite: 15]
            [cite_start]border: none; [cite: 16]
            [cite_start]border-radius: 8px; [cite: 16]
            [cite_start]font-size: 16px; [cite: 16]
            [cite_start]cursor: pointer; [cite: 16]
            [cite_start]transition: all 0.3s; [cite: 16]
        [cite_start]} [cite: 17]

        .btn-primary {
            [cite_start]background: #667eea; [cite: 17]
            [cite_start]color: white; [cite: 18]
        }

        .btn-primary:hover {
            [cite_start]background: #5a67d8; [cite: 18]
        [cite_start]} [cite: 19]

        .btn-secondary {
            [cite_start]background: #e2e8f0; [cite: 19]
            [cite_start]color: #4a5568; [cite: 20]
        }

        .btn-secondary:hover {
            [cite_start]background: #cbd5e0; [cite: 20]
        [cite_start]} [cite: 21]

        // ë¹„í™œì„±í™”ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn:disabled {
            [cite_start]background: #cbd5e0 !important; [cite: 21]
            [cite_start]color: #a0aec0 !important; [cite: 22]
            [cite_start]cursor: not-allowed !important; [cite: 22]
            [cite_start]opacity: 0.6; [cite: 22]
        }

        // í”Œë ˆì´ì–´ ëª©ë¡ ì„¹ì…˜ */
        .players-section {
            [cite_start]margin-bottom: 30px; [cite: 22]
        [cite_start]} [cite: 23]

        .players-list {
            [cite_start]background: #f7fafc; [cite: 23]
            [cite_start]border-radius: 8px; [cite: 24]
            [cite_start]padding: 15px; [cite: 24]
            [cite_start]margin-top: 10px; [cite: 24]
        }

        .player-item {
            [cite_start]background: white; [cite: 24]
            [cite_start]padding: 10px 15px; [cite: 25]
            [cite_start]margin: 5px 0; [cite: 25]
            [cite_start]border-radius: 6px; [cite: 25]
            [cite_start]border-left: 4px solid #667eea; [cite: 25]
        [cite_start]} [cite: 26]

        .player-item.host {
            [cite_start]border-left-color: #f56565; [cite: 26]
        [cite_start]} [cite: 27]

        // ë¯¸ì…˜ ì„¹ì…˜ */
        .missions-section {
            [cite_start]margin-bottom: 30px; [cite: 27]
        [cite_start]} [cite: 28]

        .mission-input-area {
            [cite_start]display: flex; [cite: 28]
            [cite_start]gap: 10px; [cite: 29]
            [cite_start]margin-bottom: 15px; [cite: 29]
        }

        .mission-input {
            [cite_start]flex: 1; [cite: 29]
        [cite_start]} [cite: 30]

        .missions-list {
            [cite_start]background: #f7fafc; [cite: 30]
            [cite_start]border-radius: 8px; [cite: 31]
            [cite_start]padding: 15px; [cite: 31]
            [cite_start]max-height: 200px; [cite: 31]
            [cite_start]overflow-y: auto; [cite: 31]
        }

        .mission-item {
            [cite_start]background: white; [cite: 31]
            [cite_start]padding: 10px 15px; [cite: 32]
            [cite_start]margin: 5px 0; [cite: 32]
            [cite_start]border-radius: 6px; [cite: 32]
            [cite_start]display: flex; [cite: 32]
            [cite_start]justify-content: space-between; [cite: 32]
            [cite_start]align-items: center; [cite: 32]
        [cite_start]} [cite: 33]

        .delete-btn {
            [cite_start]background: #e53e3e; [cite: 33]
            [cite_start]color: white; [cite: 34]
            [cite_start]border: none; [cite: 34]
            [cite_start]border-radius: 4px; [cite: 34]
            [cite_start]padding: 5px 10px; [cite: 34]
            [cite_start]cursor: pointer; [cite: 34]
            [cite_start]font-size: 12px; [cite: 34]
        [cite_start]} [cite: 35]

        // ê²Œì„ ì˜µì…˜ ì„¹ì…˜ */
        .game-options {
            [cite_start]display: flex; [cite: 35]
            [cite_start]gap: 20px; [cite: 36]
            [cite_start]align-items: center; [cite: 36]
            [cite_start]margin-bottom: 30px; [cite: 36]
            [cite_start]flex-wrap: wrap; [cite: 36]
        }

        .radio-group {
            [cite_start]display: flex; [cite: 36]
            [cite_start]gap: 15px; [cite: 37]
        }

        .radio-item {
            [cite_start]display: flex; [cite: 37]
            [cite_start]align-items: center; [cite: 38]
            [cite_start]gap: 5px; [cite: 38]
        }

        // ê²Œì„ ì§„í–‰ í™”ë©´ */
        .game-area {
            [cite_start]padding: 30px; [cite: 38]
            [cite_start]display: none; [cite: 39]
        }

        // ë¹™ê³ íŒ */
        .bingo-board {
            [cite_start]display: grid; [cite: 39]
            [cite_start]gap: 10px; [cite: 40]
            [cite_start]max-width: 500px; [cite: 40]
            [cite_start]margin: 0 auto 30px auto; [cite: 40]
            [cite_start]grid-template-columns: repeat(3, 1fr); [cite: 40]
            // 3x3ìœ¼ë¡œ ê³ ì • */
        [cite_start]} [cite: 41]

        // ë¹™ê³  ì…€ */
        .bingo-cell {
            [cite_start]aspect-ratio: 1; [cite: 41]
            // ê°€ë¡œì„¸ë¡œ ë¹„ìœ¨ 1:1 ìœ ì§€ */
            [cite_start]background: #e2e8f0; [cite: 42]
            [cite_start]border: 2px solid #cbd5e0; [cite: 43]
            [cite_start]border-radius: 8px; [cite: 43]
            [cite_start]display: flex; [cite: 43]
            [cite_start]align-items: center; [cite: 43]
            [cite_start]justify-content: center; [cite: 43]
            [cite_start]font-size: 20px; [cite: 43]
            [cite_start]font-weight: bold; [cite: 44]
            [cite_start]cursor: pointer; [cite: 44]
            [cite_start]transition: all 0.3s; [cite: 44]
            [cite_start]color: #4a5568; [cite: 44]
            word-break: break-all; // ê¸´ í…ìŠ¤íŠ¸ ê°•ì œ ì¤„ë°”ê¿ˆ (ìœ ì§€) */
            [cite_start]text-align: center; [cite: 44]
            [cite_start]padding: 5px; [cite: 45]
            
            // [í•µì‹¬ ìˆ˜ì • 1] í™”ë©´ ì›€ì°”ê±°ë¦¼(flicker) ë°©ì§€ */
            [cite_start]overflow: hidden; [cite: 45]
            // [í•µì‹¬ ìˆ˜ì • 2] íŒ¨ë”©ìœ¼ë¡œ ì¸í•œ í¬ê¸° ë³€ê²½ ë°©ì§€ */
            [cite_start]box-sizing: border-box; [cite: 46]
        [cite_start]} [cite: 47]

        .bingo-cell:hover {
            [cite_start]background: #cbd5e0; [cite: 47]
        [cite_start]} [cite: 48]

        // Flipped (ì²´í¬ë¨) ë° Failed (ì‹¤íŒ¨) ìƒíƒœ */
        .bingo-cell.flipped,
        .bingo-cell.failed {
            [cite_start]color: white; [cite: 48]
            // [í•µì‹¬ ìˆ˜ì • 3] ë™ì /ë°˜ì‘í˜• í°íŠ¸ í¬ê¸° ì ìš© */
            // í™”ë©´ ë„ˆë¹„ì— ë”°ë¼ í°íŠ¸ í¬ê¸°ë¥¼ 8px ~ 13px ì‚¬ì´ì—ì„œ ìœ ì—°í•˜ê²Œ ì¡°ì ˆí•©ë‹ˆë‹¤.
            [cite_start]*/ [cite: 50]
            [cite_start]font-size: clamp(8px, 3vw, 13px); [cite: 51]
            // [í•µì‹¬ ìˆ˜ì • 4] ì¤„ ê°„ê²©ì„ ì¡°ì ˆí•˜ì—¬ ê°€ë…ì„± í™•ë³´ */
            [cite_start]line-height: 1.15; [cite: 52]
        }

        // Flipped (ì²´í¬ë¨) ìƒíƒœ ê³ ìœ  ìŠ¤íƒ€ì¼ */
        .bingo-cell.flipped {
            [cite_start]background: #667eea; [cite: 52]
        [cite_start]} [cite: 53]

        // Failed (ì‹¤íŒ¨) ìƒíƒœ ê³ ìœ  ìŠ¤íƒ€ì¼ */
        .bingo-cell.failed {
            [cite_start]background: #f56565; [cite: 53]
            [cite_start]text-decoration: line-through; [cite: 54]
            [cite_start]opacity: 0.7; [cite: 54]
        }

        // ê²Œì„ ìƒíƒœ í‘œì‹œ */
        .game-status {
            [cite_start]text-align: center; [cite: 54]
            [cite_start]margin-bottom: 20px; [cite: 55]
        }

        .status-text {
            [cite_start]font-size: 18px; [cite: 55]
            [cite_start]color: #4a5568; [cite: 56]
            [cite_start]margin-bottom: 10px; [cite: 56]
        }

        .room-code-display {
            [cite_start]background: #667eea; [cite: 56]
            [cite_start]color: white; [cite: 57]
            [cite_start]padding: 10px 20px; [cite: 57]
            [cite_start]border-radius: 8px; [cite: 57]
            [cite_start]font-size: 20px; [cite: 57]
            [cite_start]font-weight: bold; [cite: 58]
            [cite_start]display: inline-block; [cite: 58]
        }

        // ìˆ¨ê¹€ ì²˜ë¦¬ */
        .hidden {
            [cite_start]display: none; [cite: 59]
        }

        // ë¡œë”© ë©”ì‹œì§€ */
        .loading {
            [cite_start]text-align: center; [cite: 59]
            [cite_start]color: #667eea; [cite: 60]
            [cite_start]font-style: italic; [cite: 60]
        }

        // ì˜¤ë¥˜ ë©”ì‹œì§€ */
        .error {
            [cite_start]background: #fed7d7; [cite: 60]
            [cite_start]color: #c53030; [cite: 61]
            [cite_start]padding: 10px; [cite: 61]
            [cite_start]border-radius: 6px; [cite: 61]
            [cite_start]margin: 10px 0; [cite: 61]
        }

        // ì„±ê³µ ë©”ì‹œì§€ */
        .success {
            [cite_start]background: #c6f6d5; [cite: 61]
            [cite_start]color: #2f855a; [cite: 62]
            [cite_start]padding: 10px; [cite: 62]
            [cite_start]border-radius: 6px; [cite: 62]
            [cite_start]margin: 10px 0; [cite: 62]
        }

        // Bingo Button ìŠ¤íƒ€ì¼ */
        #bingo-button {
            [cite_start]background-color: #4CAF50; [cite: 63]
            [cite_start]color: white; [cite: 63]
            [cite_start]padding: 15px 30px; [cite: 63]
            [cite_start]font-size: 24px; [cite: 64]
            [cite_start]font-weight: bold; [cite: 64]
            [cite_start]border: none; [cite: 64]
            [cite_start]border-radius: 10px; [cite: 64]
            [cite_start]cursor: pointer; [cite: 64]
            [cite_start]transition: background-color 0.3s ease, transform 0.1s ease; [cite: 64]
            [cite_start]margin-top: 20px; [cite: 64]
            [cite_start]display: block; [cite: 65]
            // í•­ìƒ ë³´ì´ë„ë¡ ì„¤ì • */
            [cite_start]width: 100%; [cite: 65]
            [cite_start]max-width: 300px; [cite: 66]
            [cite_start]box-sizing: border-box; [cite: 66]
        }
        
        #bingo-button:hover:not(:disabled) {
            [cite_start]background-color: #45a049; [cite: 68]
            [cite_start]transform: scale(1.05); [cite: 68]
        }
        
        #bingo-button:disabled {
            [cite_start]background-color: #ccc; [cite: 70]
            [cite_start]cursor: not-allowed; [cite: 70]
            [cite_start]opacity: 0.7; [cite: 70]
        }

        // ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
        .game-buttons {
            [cite_start]display: flex; [cite: 71]
            [cite_start]flex-direction: column; [cite: 71]
            [cite_start]align-items: center; [cite: 71]
            [cite_start]gap: 10px; [cite: 71]
            box-sizing: border-box; // ì¶”ê°€: íŒ¨ë”© í¬í•¨ ë„ˆë¹„ ê³„ì‚° */
        }

        // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ íŒì—…ìš© ì˜¤ë²„ë ˆì´ */
        .password-overlay {
            [cite_start]position: fixed; [cite: 71]
            [cite_start]top: 0; [cite: 72]
            [cite_start]left: 0; [cite: 72]
            [cite_start]width: 100%; [cite: 72]
            [cite_start]height: 100%; [cite: 72]
            [cite_start]background-color: rgba(0, 0, 0, 0.7); [cite: 72]
            [cite_start]display: flex; [cite: 72]
            [cite_start]justify-content: center; [cite: 73]
            [cite_start]align-items: center; [cite: 73]
            z-index: 2000; // ìŠ¹ë¦¬ ì˜¤ë²„ë ˆì´ë³´ë‹¤ ë†’ê²Œ ì„¤ì • */
        }

        .password-prompt {
            [cite_start]background-color: white; [cite: 73]
            [cite_start]padding: 30px; [cite: 74]
            [cite_start]border-radius: 10px; [cite: 74]
            [cite_start]box-shadow: 0 5px 15px rgba(0,0,0,0.3); [cite: 74]
            [cite_start]text-align: center; [cite: 74]
            [cite_start]width: 90%; [cite: 74]
            [cite_start]max-width: 400px; [cite: 75]
        [cite_start]} [cite: 75]

        .password-prompt h3 {
            [cite_start]margin-bottom: 20px; [cite: 76]
            [cite_start]color: #4a5568; [cite: 76]
        }

        .password-prompt input {
            [cite_start]width: calc(100% - 24px); [cite: 76]
            // íŒ¨ë”© ê³ ë ¤ */
            [cite_start]padding: 12px; [cite: 77]
            [cite_start]margin-bottom: 15px; [cite: 78]
            [cite_start]border: 1px solid #e2e8f0; [cite: 78]
            [cite_start]border-radius: 5px; [cite: 78]
            [cite_start]font-size: 18px; [cite: 78]
        }

        .password-prompt button {
            [cite_start]padding: 10px 20px; [cite: 79]
            [cite_start]background-color: #667eea; [cite: 79]
            [cite_start]color: white; [cite: 79]
            [cite_start]border: none; [cite: 79]
            [cite_start]border-radius: 5px; [cite: 79]
            [cite_start]cursor: pointer; [cite: 79]
            [cite_start]font-size: 16px; [cite: 80]
            [cite_start]margin: 0 5px; [cite: 80]
        [cite_start]} [cite: 80]
        .password-prompt button:hover {
            [cite_start]background-color: #5a67d8; [cite: 81]
        [cite_start]} [cite: 81]

        // ìŠ¹ë¦¬ ë©”ì‹œì§€ ì˜¤ë²„ë ˆì´ */
        .winner-overlay {
            [cite_start]position: fixed; [cite: 81]
            [cite_start]top: 0; [cite: 82]
            [cite_start]left: 0; [cite: 82]
            [cite_start]width: 100%; [cite: 82]
            [cite_start]height: 100%; [cite: 82]
            [cite_start]background-color: rgba(0, 0, 0, 0.7); [cite: 83]
            // ë°˜íˆ¬ëª… ê²€ì • ë°°ê²½ */
            [cite_start]display: flex; [cite: 83]
            [cite_start]justify-content: center; [cite: 84]
            [cite_start]align-items: center; [cite: 84]
            [cite_start]z-index: 1000; [cite: 84]
            [cite_start]animation: fadeIn 0.5s ease-out; [cite: 84]
        }

        .winner-message {
            [cite_start]background-color: white; [cite: 84]
            // íŒì—… ë°°ê²½ìƒ‰ í°ìƒ‰ */
            [cite_start]color: #4a5568; [cite: 85]
            // ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            [cite_start]font-size: 3em; [cite: 86]
            [cite_start]font-weight: bold; [cite: 87]
            [cite_start]text-align: center; [cite: 87]
            [cite_start]padding: 40px; [cite: 87]
            [cite_start]border-radius: 20px; [cite: 87]
            [cite_start]box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); [cite: 88]
            [cite_start]animation: zoomIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; [cite: 88]
            [cite_start]position: relative; [cite: 88]
            [cite_start]overflow: hidden; [cite: 88]
            [cite_start]display: flex; [cite: 88]
            [cite_start]flex-direction: column; [cite: 89]
            [cite_start]align-items: center; [cite: 89]
            [cite_start]gap: 15px; [cite: 89]
        }

        // í…ìŠ¤íŠ¸ì—ë§Œ ê·¸ë¼ë°ì´ì…˜ ì ìš© */
        .gradient-text {
            [cite_start]background: linear-gradient(45deg, #f3ec78, #af4261); [cite: 90]
            [cite_start]-webkit-background-clip: text; [cite: 90]
            [cite_start]-webkit-text-fill-color: transparent; [cite: 90]
            [cite_start]background-clip: text; [cite: 90]
            color: transparent; // Fallback for browsers not supporting text-fill-color */
        }

        .winner-message .emoji {
            [cite_start]font-size: 1.5em; [cite: 91]
            [cite_start]-webkit-text-fill-color: initial; [cite: 91]
            [cite_start]background: none; [cite: 91]
        }

        .winner-message .winner-text {
            [cite_start]font-size: 1em; [cite: 92]
            [cite_start]line-height: 1.3; [cite: 92]
        }

        .winner-message .btn {
            [cite_start]background-color: #667eea; [cite: 93]
            [cite_start]color: white; [cite: 93]
            [cite_start]border: none; [cite: 93]
            [cite_start]padding: 10px 20px; [cite: 93]
            [cite_start]border-radius: 8px; [cite: 93]
            [cite_start]cursor: pointer; [cite: 94]
            [cite_start]font-size: 0.6em; [cite: 94]
            [cite_start]transition: background-color 0.3s; [cite: 94]
        }

        .winner-message .btn:hover {
            [cite_start]background-color: #5a67d8; [cite: 95]
        [cite_start]} [cite: 95]

        // ì• ë‹ˆë©”ì´ì…˜ í‚¤í”„ë ˆì„ */
        @keyframes fadeIn {
            [cite_start]from { opacity: 0; [cite: 96] }
            [cite_start]to { opacity: 1; [cite: 97] }
        }

        @keyframes zoomIn {
            [cite_start]from { transform: scale(0.5); [cite: 98] opacity: 0; }
            [cite_start]to { transform: scale(1); opacity: 1; [cite: 99] }
        }

        // ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                [cite_start]margin: 10px; [cite: 100]
            }
            
            .button-group {
                [cite_start]flex-direction: column; [cite: 101]
            }
            
            .game-options {
                [cite_start]flex-direction: column; [cite: 102]
                [cite_start]align-items: flex-start; [cite: 102]
            }

            .winner-message {
                [cite_start]font-size: 2em; [cite: 103]
                [cite_start]padding: 20px; [cite: 103]
            }
        }

        // ìƒˆë¡œìš´ flex ì»¨í…Œì´ë„ˆë¥¼ ìœ„í•œ ìŠ¤íƒ€ì¼ */
        .create-room-controls {
            [cite_start]display: flex; [cite: 104]
            [cite_start]flex-wrap: wrap; [cite: 104]
            align-items: flex-end; // ë²„íŠ¼ê³¼ ë“œë¡­ë‹¤ìš´ì´ ë°”ë‹¥ì„ ì— ì •ë ¬ë˜ë„ë¡ */
            [cite_start]gap: 10px; [cite: 105]
            [cite_start]margin-top: 15px; [cite: 105]
        }

        .create-room-controls .input-group {
            [cite_start]margin-bottom: 0; [cite: 106]
            // ì´ ê·¸ë£¹ ë‚´ë¶€ì˜ input-groupì€ ë§ˆì§„ ì œê±° */
        }

        // max-players select boxì˜ ë„ˆë¹„ë¥¼ ì¡°ì •í•˜ì—¬ ë²„íŠ¼ê³¼ ì˜ ì–´ìš¸ë¦¬ê²Œ */
        .create-room-controls #max-players-create {
            [cite_start]width: auto; [cite: 107]
            // ìë™ ë„ˆë¹„ */
            [cite_start]min-width: 100px; [cite: 108]
            // ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
            [cite_start]flex-grow: 1; [cite: 109]
            // ë‚¨ì€ ê³µê°„ì„ ì±„ìš°ë„ë¡ ì„±ì¥ */
        }

        // 'ìƒˆ ë°© ë§Œë“¤ê¸°' ë²„íŠ¼ í¬ê¸° í‚¤ìš°ê¸° */
        .create-room-controls #create-room-btn {
            [cite_start]padding: 15px 30px; [cite: 110]
            // íŒ¨ë”©ì„ ëŠ˜ë ¤ í¬ê¸° í‚¤ì›€ */
            [cite_start]font-size: 18px; [cite: 111]
            // ê¸€ì í¬ê¸° í‚¤ì›€ */
            [cite_start]flex-shrink: 0; [cite: 112]
            // ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
        }

        // ë°© ì…ì¥í•˜ê¸° ë²„íŠ¼ ìˆ¨ê¹€ì„ ìœ„í•œ í´ë˜ìŠ¤ ì¶”ê°€ (ì´ˆëŒ€ë§í¬ ì‹œ) */
        .hidden-by-url-param {
            [cite_start]display: none !important; [cite: 113]
            // ìš°ì„ ìˆœìœ„ ë†’ì„ */
        }

        // ìµœëŒ€ í”Œë ˆì´ì–´ ìˆ˜ ë“œë¡­ë‹¤ìš´ì˜ labelê³¼ selectê°€ ê°€ë¡œë¡œ ë‚˜ë€íˆ ì˜¤ë„ë¡ */
        .input-group.inline-label {
            [cite_start]display: flex; [cite: 114]
            [cite_start]align-items: center; [cite: 114]
            [cite_start]gap: 10px; [cite: 114]
            [cite_start]flex-grow: 1; [cite: 114]
        }

        .input-group.inline-label label {
            [cite_start]margin-bottom: 0; [cite: 115]
            flex-shrink: 0; // ë¼ë²¨ì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
        [cite_start]} [cite: 115]
        .input-group.inline-label select {
            [cite_start]width: auto; [cite: 116]
            // selectê°€ ìë™ìœ¼ë¡œ ë„ˆë¹„ ì¡°ì • */
            [cite_start]flex-grow: 1; [cite: 117]
            // ë‚¨ì€ ê³µê°„ ì±„ìš°ê¸° */
        [cite_start]} [cite: 117]

        // ë¡œë”© ì¸ë””ì¼€ì´í„° ì¶”ê°€ */
        .loading-indicator {
            [cite_start]display: inline-block; [cite: 118]
            [cite_start]width: 16px; [cite: 118]
            [cite_start]height: 16px; [cite: 118]
            [cite_start]border: 2px solid #f3f3f3; [cite: 118]
            [cite_start]border-top: 2px solid #667eea; [cite: 119]
            [cite_start]border-radius: 50%; [cite: 119]
            [cite_start]animation: spin 1s linear infinite; [cite: 119]
            [cite_start]margin-right: 8px; [cite: 119]
        }

        @keyframes spin {
            [cite_start]0% { transform: rotate(0deg); [cite: 120] }
            [cite_start]100% { transform: rotate(360deg); [cite: 121] }
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ ë°ˆì£¼ë¨¸ë‹ˆ ë¹™ê³  ê²Œì„!</h1>
            <p>ë°ˆì£¼ë¨¸ë‹ˆì™€ í•¨ê»˜ ì¦ê¸°ëŠ” ìê¸° ë¹™ê³ !</p>
            <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">
                v4.982 - í„´ ì‚­ì œ
            [cite_start]</div> [cite: 122]
        </div>

        <div id="game-setup" class="game-setup">
            <div class="room-section">
                <h2>ğŸ  ë°© ì„¤ì •</h2>
                <div class="input-group">
                    <label for="player-name">í”Œë ˆì´ì–´ ì´ë¦„</label>
                    [cite_start]<input type="text" id="player-name" placeholder="ë‹¹ì‹ ì˜ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10"> [cite: 123]
                </div>
                
                <div class="create-room-controls">
                    <div class="input-group inline-label" id="max-players-create-group">
                        [cite_start]<label for="max-players-create">ìµœëŒ€ í”Œë ˆì´ì–´ ìˆ˜:</label> [cite: 124]
                        <select id="max-players-create">
                            <option value="2">2ëª…</option>
                            [cite_start]<option value="3">3ëª…</option> [cite: 125]
                            <option value="4">4ëª…</option>
                            <option value="5">5ëª…</option>
                            <option value="6">6ëª…</option>
                            [cite_start]<option value="7">7ëª…</option> [cite: 126]
                            <option value="8">8ëª…</option>
                            <option value="9">9ëª…</option>
                            [cite_start]<option value="10">10ëª…</option> [cite: 127]
                            <option value="11">11ëª…</option>
                            <option value="12">12ëª…</option>
                        </select>
                    [cite_start]</div> [cite: 128]
                    <button class="btn btn-primary" id="create-room-btn" onclick="createRoom()">ìƒˆ ë°© ë§Œë“¤ê¸°</button>
                </div>

                <div class="button-group" id="main-action-buttons" style="margin-top: 15px;">
                    <button class="btn btn-secondary" id="show-join-room-btn" onclick="showJoinRoom()">ë°© ì…ì¥í•˜ê¸°</button>
                [cite_start]</div> [cite: 129]

                <div id="join-room-section" class="hidden" style="margin-top: 15px;">
                    <div class="input-group">
                        <label for="room-code">ë°© ì½”ë“œ</label>
                        [cite_start]<input type="text" id="room-code" placeholder="ë°© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" maxlength="8"> [cite: 130]
                    </div>
                    <button class="btn btn-primary" onclick="joinRoom()">ë°© ì…ì¥</button>
                    [cite_start]<p id="auto-join-hint" class="hidden" style="color: #667eea; [cite: 131] font-size: 14px; margin-top: 10px;">
                        
                    </p>
                </div>

                <div id="status-message"></div>
                
                [cite_start]<div id="share-section" class="hidden" style="margin-top: 20px;"> [cite: 132]
                    [cite_start]<div style="background: #f7fafc; [cite: 133] padding: 15px; border-radius: 8px; border: 2px solid #667eea;">
                        [cite_start]<h4 style="color: #4a5568; [cite: 134] margin-bottom: 10px;">ğŸ”— ì¹œêµ¬ ì´ˆëŒ€ ë§í¬</h4>
                        [cite_start]<div style="display: flex; [cite: 135] gap: 10px; align-items: center;">
                            [cite_start]<input type="text" id="share-link" readonly style="flex: 1; [cite: 136] [cite_start]background: white; border: 1px solid #e2e8f0; padding: 8px; border-radius: 4px; [cite: 137] font-size: 14px;">
                            <button class="btn btn-primary" onclick="copyShareLink()" style="padding: 8px 16px;">ë³µì‚¬</button>
                        </div>
                        [cite_start]<p style="color: #718096; [cite: 138] font-size: 12px; margin-top: 8px;">
                            ì´ ë§í¬ë¥¼ ì¹œêµ¬ë“¤ì—ê²Œ ë³´ë‚´ë©´ ë°”ë¡œ ë°©ì— ì…ì¥í•  ìˆ˜ ìˆì–´ìš”!
                        </p>
                    </div>
                </div>
            [cite_start]</div> [cite: 139]

            <div class="players-section">
                <h3>ğŸ‘¥ ì°¸ê°€ì ëª©ë¡</h3>
                <div class="players-list" id="players-list">
                    <div class="loading">ë°©ì— ì…ì¥í•˜ë©´ ì°¸ê°€ìê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
                [cite_start]</div> [cite: 140]
            </div>

            <div class="missions-section">
                <h3>ğŸ“ ë¯¸ì…˜ í…ìŠ¤íŠ¸</h3>
                <div class="mission-input-area">
                    <input type="text" class="mission-input" id="mission-input" placeholder="ë¯¸ì…˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="200">
                    [cite_start]<button class="btn btn-primary" id="add-mission-btn" onclick="addMission()">ì¶”ê°€</button> [cite: 141]
                </div>
                <div class="button-group" style="margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="saveMissions()">ë¯¸ì…˜ ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="loadMissions()">ë¯¸ì…˜ ë¶ˆëŸ¬ì˜¤ê¸° (ê¸°ë³¸ê°’)</button>
                [cite_start]</div> [cite: 142]
                <div class="missions-list" id="missions-list">
                    </div>
                [cite_start]<div id="current-mission-count" style="text-align: center; [cite: 143] margin-top: 10px; font-size: 14px; color: #718096;">
                    í˜„ì¬ ë“±ë¡ëœ ë¯¸ì…˜: 0ê°œ
                </div>
            </div>

            <div class="game-options" id="game-options-section">
                <div>
                    [cite_start]<label><strong>ë¹™ê³ íŒ í¬ê¸°:</strong></label> [cite: 144]
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="board-size" value="3" id="size-3" checked disabled> <label for="size-3">3x3</label>
                        [cite_start]</div> [cite: 145]
                    </div>
                </div>
                <div>
                    <label><strong>ìŠ¹ë¦¬ ì¡°ê±´:</strong></label>
                    [cite_start]<div class="radio-group"> [cite: 146]
                        <div class="radio-item">
                            <input type="radio" name="win-condition" value="1" id="win-1" checked>
                            <label for="win-1">1ì¤„ ë¹™ê³ </label>
                        [cite_start]</div> [cite: 147]
                        <div class="radio-item">
                            <input type="radio" name="win-condition" value="2" id="win-2">
                            [cite_start]<label for="win-2">2ì¤„ ë¹™ê³ </label> [cite: 148]
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="win-condition" value="3" id="win-3">
                            [cite_start]<label for="win-3">3ì¤„ ë¹™ê³ </label> [cite: 149]
                        </div>
                    </div>
                </div>
                
                </div>

            <div style="text-align: center;">
                [cite_start]<button class="btn btn-primary" id="start-game-btn" onclick="startGame()" style="font-size: 18px; [cite: 152] padding: 15px 30px;">
                    ğŸ® ê²Œì„ ì‹œì‘!
                [cite_start]</button> [cite: 153]
            </div>
        </div>

        <div id="game-area" class="game-area">
            <div class="game-status">
                [cite_start]<div class="status-text">ë°© ì½”ë“œ: <span class="room-code-display" id="current-room-code">ABC123">ABC123</span></div> [cite: 154]
                <div class="status-text">ì„ íƒ ëœ ìˆ«ì: <strong id="flipped-numbers-count">0</strong></div> </div>

            <div class="bingo-board" id="bingo-board">
                </div>
            
            [cite_start]<div class="game-buttons"> [cite: 155]
                <button id="bingo-button" class="btn btn-primary" onclick="claimBingo()" disabled>
                    [cite_start]ğŸ‰ ë¹™ê³ ! [cite: 156]
                </button>
                </div>

            <div style="text-align: center; margin-top: 20px;">
                [cite_start]<button class="btn btn-secondary" onclick="backToSetup()">ê²Œì„ ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button> [cite: 157]
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyAqHKfUCypD_Jk7mXgH5u-O1XS7Dje4DZ8",
            authDomain: "mim-bingo-game.firebaseapp.com",
            [cite_start]databaseURL: "https://mim-bingo-game-default-rtdb.asia-southeast1.firebasedatabase.app", [cite: 158]
            [cite_start]projectId: "mim-bingo-game", [cite: 158]
            [cite_start]storageBucket: "mim-bingo-game.firebasestorage.app", [cite: 158]
            [cite_start]messagingSenderId: "436254307510", [cite: 158]
            [cite_start]appId: "1:436254307510:web:23ad7c9a0d10d8ad26217" [cite: 158]
        [cite_start]}; [cite: 159]
        // Firebase ì´ˆê¸°í™”
        [cite_start]firebase.initializeApp(firebaseConfig); [cite: 159]
        [cite_start]const database = firebase.database(); [cite: 159]
        [cite_start]const auth = firebase.auth(); [cite: 160]

        // ê¸°ë³¸ ë¯¸ì…˜ ëª©ë¡ (localStorageì— ì €ì¥ëœ ë¯¸ì…˜ì´ ì—†ì„ ê²½ìš° ì‚¬ìš©)
        const defaultMissions = [
            "ë¯¸ì…˜1",
            "ë¯¸ì…˜2",
            "ë¯¸ì…˜3",
            "ë¯¸ì…˜4",
            "ë¯¸ì…˜5",
            "ë¯¸ì…˜6",
            [cite_start]"ë¯¸ì…˜7", [cite: 161]
            [cite_start]"ë¯¸ì…˜8", [cite: 161]
            [cite_start]"ë¯¸ì…˜9", [cite: 161]
            [cite_start]"ë¯¸ì…˜10" [cite: 161]
        [cite_start]]; [cite: 162]

        // ê²Œì„ ìƒíƒœ ë³€ìˆ˜ë“¤
        let gameState = {
            [cite_start]isHost: false, [cite: 162]
            [cite_start]roomCode: '', [cite: 162]
            [cite_start]playerName: '', [cite: 162]
            [cite_start]playerUID: null, [cite: 163]
            [cite_start]players: {}, [cite: 163]
            [cite_start]missions: [], [cite: 163]
            [cite_start]winCondition: 1, [cite: 163]
            [cite_start]boardSize: 3, [cite: 163]
            [cite_start]maxPlayers: 2, [cite: 163]
            [cite_start]gameStarted: false, [cite: 163]
            [cite_start]bingoBoard: [], [cite: 163]
            currentTurn: 0, // í„´ ê°œë…ì€ ìœ ì§€í•˜ì§€ë§Œ, í„´ ì œí•œ ì—†ì´ í´ë¦­ ê°€ëŠ¥
            [cite_start]playerList: [], [cite: 164]
            [cite_start]roomRef: null, [cite: 164]
            [cite_start]missionMap: {}, [cite: 164]
            [cite_start]canClaimBingo: false, [cite: 164]
            [cite_start]flippedNumbers: [], [cite: 165]
            hasMadeMoveInTurn: false, // ì´ ë³€ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•Šì§€ë§Œ, ê¸°ì¡´ ë¡œì§ì—ì„œ ì œê±°ë˜ì§€ ì•Šë„ë¡ ìœ ì§€
            [cite_start]isAuthReady: false [cite: 165]
        [cite_start]}; [cite: 165]

        // í˜¸ìŠ¤íŠ¸ ì „ìš© ë¹„ë°€ë²ˆí˜¸
        [cite_start]const HOST_PASSWORD = "0804"; [cite: 165]

        // UI ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateButtonStates() {
            [cite_start]const createRoomBtn = document.getElementById('create-room-btn'); [cite: 166]
            [cite_start]const joinRoomBtn = document.querySelector('button[onclick="joinRoom()"]'); [cite: 167]
            
            if (gameState.isAuthReady) {
                // ì¸ì¦ ì™„ë£Œ ì‹œ ë²„íŠ¼ í™œì„±í™”
                [cite_start]createRoomBtn.disabled = false; [cite: 167]
                [cite_start]createRoomBtn.innerHTML = 'ìƒˆ ë°© ë§Œë“¤ê¸°'; [cite: 168]
                if (joinRoomBtn) {
                    [cite_start]joinRoomBtn.disabled = false; [cite: 168]
                    [cite_start]joinRoomBtn.innerHTML = 'ë°© ì…ì¥'; [cite: 169]
                }
            } else {
                // ì¸ì¦ ëŒ€ê¸° ì‹œ ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
                [cite_start]createRoomBtn.disabled = true; [cite: 169]
                [cite_start]createRoomBtn.innerHTML = '<span class="loading-indicator"></span>ë¡œê·¸ì¸ ì¤‘...'; [cite: 170]
                if (joinRoomBtn) {
                    [cite_start]joinRoomBtn.disabled = true; [cite: 170]
                    [cite_start]joinRoomBtn.innerHTML = '<span class="loading-indicator"></span>ë¡œê·¸ì¸ ì¤‘...'; [cite: 171]
                }
            }
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type = 'info') {
            [cite_start]const statusDiv = document.getElementById('status-message'); [cite: 171]
            [cite_start]statusDiv.innerHTML = `<div class="${type}">${message}</div>`; [cite: 172]
            [cite_start]statusDiv.style.opacity = '1'; [cite: 172]
            [cite_start]statusDiv.style.transition = 'opacity 0.5s ease-out'; [cite: 173]
            setTimeout(() => {
                [cite_start]statusDiv.style.opacity = '0'; [cite: 173]
                setTimeout(() => {
                    [cite_start]statusDiv.innerHTML = ''; [cite: 173]
                [cite_start]}, 500); [cite: 173]
            [cite_start]}, 3000); [cite: 174]
        }

        // --- ìµëª… ë¡œê·¸ì¸ ì²˜ë¦¬ ë¡œì§ ---
        auth.onAuthStateChanged(user => {
            if (user) {
                console.log("Firebase Anonymous User UID:", user.uid);
                gameState.playerUID = user.uid;
                gameState.isAuthReady = true;
                [cite_start]updateButtonStates(); [cite: 175]
                
                // URL íŒŒë¼ë¯¸í„° ì²´í¬ (ìë™ ì…ì¥)
                checkURLParams();
            } else {
                [cite_start]console.log("No Firebase user logged in. Signing in anonymously..."); [cite: 176]
                [cite_start]gameState.isAuthReady = false; [cite: 176]
                [cite_start]updateButtonStates(); [cite: 176]
                
                auth.signInAnonymously()
                    .then(() => {
                        // ì„±ê³µì ìœ¼ë¡œ ìµëª… ë¡œê·¸ì¸ë˜ì—ˆìœ¼ë¯€ë¡œ, onAuthStateChanged ì½œë°±ì´ ë‹¤ì‹œ í˜¸ì¶œë  ê²ƒì…ë‹ˆë‹¤.
                    [cite_start]}) [cite: 177]
                    .catch((error) => {
                        [cite_start]console.error("Error signing in anonymously:", error); [cite: 178]
                        [cite_start]showMessage('ê²Œì„ì— ì ‘ì†í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error'); [cite: 179]
                        [cite_start]gameState.isAuthReady = false; [cite: 179]
                        [cite_start]updateButtonStates(); [cite: 179]
                    });
            }
        [cite_start]}); [cite: 180]

        // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ íŒì—… ìƒì„± í•¨ìˆ˜
        function createPasswordPrompt() {
            return new Promise((resolve) => {
                const overlay = document.createElement('div');
                overlay.className = 'password-overlay';

                const promptBox = document.createElement('div');
                [cite_start]promptBox.className = 'password-prompt'; [cite: 181]
                promptBox.innerHTML = `
                    <h3>ë°©ì¥ì´ ë˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</h3>
                    <input type="password" id="host-password-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
                    <button id="password-submit-btn">í™•ì¸</button>
                    [cite_start]<button id="password-cancel-btn">ì·¨ì†Œ</button> [cite: 182]
                `;
                [cite_start]overlay.appendChild(promptBox); [cite: 182]
                [cite_start]document.body.appendChild(overlay); [cite: 182]

                [cite_start]const passwordInput = document.getElementById('host-password-input'); [cite: 183]
                [cite_start]const submitBtn = document.getElementById('password-submit-btn'); [cite: 184]
                [cite_start]const cancelBtn = document.getElementById('password-cancel-btn'); [cite: 184]
                const cleanup = () => {
                    [cite_start]document.body.removeChild(overlay); [cite: 184]
                    [cite_start]submitBtn.removeEventListener('click', handleSubmit); [cite: 185]
                    [cite_start]cancelBtn.removeEventListener('click', handleCancel); [cite: 185]
                    [cite_start]passwordInput.removeEventListener('keypress', handleKeyPress); [cite: 185]
                };

                const handleSubmit = () => {
                    [cite_start]const password = passwordInput.value; [cite: 186]
                    [cite_start]cleanup(); [cite: 186]
                    [cite_start]resolve(password); [cite: 186]
                };

                const handleCancel = () => {
                    [cite_start]cleanup(); [cite: 187]
                    [cite_start]resolve(null); [cite: 187]
                };

                const handleKeyPress = (e) => {
                    if (e.key === 'Enter') {
                        [cite_start]handleSubmit(); [cite: 188]
                    }
                };

                [cite_start]submitBtn.addEventListener('click', handleSubmit); [cite: 189]
                [cite_start]cancelBtn.addEventListener('click', handleCancel); [cite: 189]
                [cite_start]passwordInput.addEventListener('keypress', handleKeyPress); [cite: 189]
                [cite_start]passwordInput.focus(); [cite: 189]
            });
        }

        // ë°© ìƒì„± (í˜¸ìŠ¤íŠ¸ ë¹„ë°€ë²ˆí˜¸ í•„ìš”)
        async function createRoom() {
            [cite_start]const playerNameInput = document.getElementById('player-name').value.trim(); [cite: 190]
            if (!playerNameInput) {
                [cite_start]showMessage('í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error'); [cite: 191]
                return;
            }

            // ì¸ì¦ ìƒíƒœ í™•ì¸
            if (!gameState.isAuthReady || !gameState.playerUID) {
                [cite_start]showMessage('ì•„ì§ ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error'); [cite: 192]
                return;
            }

            [cite_start]const password = await createPasswordPrompt(); [cite: 193]
            if (password !== HOST_PASSWORD) {
                [cite_start]showMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•Šê±°ë‚˜ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'error'); [cite: 194]
                return;
            }

            try {
                [cite_start]gameState.isHost = true; [cite: 195]
                [cite_start]gameState.playerName = playerNameInput; [cite: 195]
                [cite_start]gameState.roomCode = generateRoomCode(); [cite: 195]
                [cite_start]gameState.maxPlayers = parseInt(document.getElementById('max-players-create').value); [cite: 195]
                
                [cite_start]gameState.roomRef = database.ref('rooms/' + gameState.roomCode); [cite: 196]
                await gameState.roomRef.set({
                    host: gameState.playerUID,
                    players: {
                        [gameState.playerUID]: {
                            name: gameState.playerName,
                            [cite_start]isHost: true, [cite: 197]
                            [cite_start]joinedAt: Date.now(), [cite: 197]
                            [cite_start]boardState: {} [cite: 198]
                        }
                    },
                    missions: gameState.missions,
                    gameStarted: false,
                    winCondition: 1,
                    [cite_start]boardSize: gameState.boardSize, [cite: 199]
                    [cite_start]maxPlayers: gameState.maxPlayers, [cite: 199]
                    [cite_start]createdAt: Date.now(), [cite: 199]
                    [cite_start]flippedNumbers: {}, [cite: 199]
                    currentTurn: 0, // ì„ ê³µ ì„ íƒ ë¡œì§ ì œê±°ì— ë”°ë¼ 0ìœ¼ë¡œ ê³ ì •
                    [cite_start]winner: null, [cite: 200]
                    [cite_start]gameEnded: false, [cite: 200]
                    [cite_start]missionMap: {}, [cite: 200]
                    [cite_start]bingoClaimed: null, [cite: 201]
                    [cite_start]playerOrderUids: [gameState.playerUID] [cite: 201]
                });

                [cite_start]setupRoomListeners(); [cite: 202]
                [cite_start]const shareLink = `${window.location.origin}${window.location.pathname}?room=${gameState.roomCode}`; [cite: 202]
                [cite_start]document.getElementById('share-link').value = shareLink; [cite: 202]
                [cite_start]document.getElementById('share-section').classList.remove('hidden'); [cite: 202]
                
                [cite_start]showMessage(`ë°©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ë°© ì½”ë“œ: ${gameState.roomCode}`, 'success'); [cite: 202]
            } catch (error) {
                [cite_start]showMessage('ë°© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error'); [cite: 203]
                [cite_start]console.error('ë°© ìƒì„± ì˜¤ë¥˜:', error); [cite: 204]
            }
        }

        // ë°© ì…ì¥ UI í‘œì‹œ
        function showJoinRoom() {
            [cite_start]document.getElementById('join-room-section').classList.remove('hidden'); [cite: 204]
            [cite_start]document.getElementById('create-room-btn').classList.add('hidden-by-url-param'); [cite: 205]
            [cite_start]document.getElementById('max-players-create-group').classList.add('hidden-by-url-param'); [cite: 205]
            [cite_start]document.getElementById('main-action-buttons').classList.add('hidden-by-url-param'); [cite: 205]
        }

        // ë°© ì…ì¥
        async function joinRoom(prefilledRoomCode = null) {
            [cite_start]const playerNameInput = document.getElementById('player-name').value.trim(); [cite: 206]
            [cite_start]const roomCode = prefilledRoomCode || document.getElementById('room-code').value.trim().toUpperCase(); [cite: 206]
            
            if (!playerNameInput) {
                [cite_start]showMessage('í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error'); [cite: 207]
                return;
            }
            
            if (!roomCode) {
                [cite_start]showMessage('ë°© ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error'); [cite: 208]
                return;
            }

            // ì¸ì¦ ìƒíƒœ í™•ì¸
            if (!gameState.isAuthReady || !gameState.playerUID) {
                [cite_start]showMessage('ì•„ì§ ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error'); [cite: 209]
                return;
            }

            try {
                [cite_start]gameState.isHost = false; [cite: 210]
                [cite_start]gameState.playerName = playerNameInput; [cite: 210]
                [cite_start]gameState.roomCode = roomCode; [cite: 210]
                [cite_start]gameState.roomRef = database.ref('rooms/' + roomCode); [cite: 210]

                [cite_start]const snapshot = await gameState.roomRef.once('value'); [cite: 211]
                if (!snapshot.exists()) {
                    [cite_start]showMessage('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°© ì½”ë“œì…ë‹ˆë‹¤!', 'error'); [cite: 212]
                    return;
                }

                [cite_start]const roomData = snapshot.val(); [cite: 213]
                if (roomData.gameStarted) {
                    [cite_start]showMessage('ì´ë¯¸ ì‹œì‘ëœ ê²Œì„ì…ë‹ˆë‹¤!', 'error'); [cite: 214]
                    return;
                }
                
                [cite_start]const currentPlayersCount = Object.keys(roomData.players || {}).length; [cite: 215]
                if (roomData.maxPlayers && currentPlayersCount >= roomData.maxPlayers) {
                    [cite_start]showMessage(`ì´ ë°©ì€ ìµœëŒ€ ${roomData.maxPlayers}ëª…ê¹Œì§€ ì°¸ì—¬ ê°€ëŠ¥í•©ë‹ˆë‹¤. í˜„ì¬ ì¸ì›: ${currentPlayersCount}ëª…`, 'error'); [cite: 216]
                    return;
                }

                if (roomData.players && roomData.players[gameState.playerUID]) {
                     [cite_start]showMessage('ì´ë¯¸ ì´ ë°©ì— ì ‘ì† ì¤‘ì…ë‹ˆë‹¤.', 'info'); [cite: 217]
                     [cite_start]setupRoomListeners(); [cite: 217]
                     return;
                }

                [cite_start]const existingPlayerNames = Object.values(roomData.players || {}).map(p => p.name); [cite: 218]
                if (existingPlayerNames.includes(playerNameInput)) {
                    [cite_start]showMessage('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë¦„ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error'); [cite: 219]
                    return;
                }

                await gameState.roomRef.child('players').child(gameState.playerUID).set({
                    name: gameState.playerName,
                    isHost: false,
                    joinedAt: Date.now(),
                    [cite_start]boardState: {} [cite: 220]
                [cite_start]}); [cite: 221]
                await gameState.roomRef.child('playerOrderUids').transaction((currentUids) => {
                    const uids = currentUids || [];
                    if (!uids.includes(gameState.playerUID)) {
                        uids.push(gameState.playerUID);
                    }
                    [cite_start]return uids; [cite: 222]
                [cite_start]}); [cite: 223]
                gameState.boardSize = roomData.boardSize || [cite_start]3; [cite: 223]
                gameState.maxPlayers = roomData.maxPlayers || [cite_start]2; [cite: 223]
                
                [cite_start]setupRoomListeners(); [cite: 224]
                [cite_start]showMessage(`ë°©ì— ì…ì¥í–ˆìŠµë‹ˆë‹¤! ë°© ì½”ë“œ: ${roomCode}`, 'success'); [cite: 224]
            } catch (error) {
                [cite_start]showMessage('ë°© ì…ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error'); [cite: 225]
                [cite_start]console.error('ë°© ì…ì¥ ì˜¤ë¥˜:', error); [cite: 225]
            }
        }

        // ë°© ë°ì´í„° ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupRoomListeners() {
            [cite_start]if (!gameState.roomRef) return; [cite: 226]
            gameState.roomRef.on('value', (snapshot) => {
                [cite_start]const roomData = snapshot.val(); [cite: 226]
                if (roomData) {
                    gameState.boardSize = roomData.boardSize || [cite_start]3; [cite: 227]
                    gameState.maxPlayers = roomData.maxPlayers || [cite_start]2; [cite: 227]
                    [cite_start]gameState.gameStarted = roomData.gameStarted || false; [cite: 227]
                    gameState.winCondition = roomData.winCondition || [cite_start]1; [cite: 227]
                    [cite_start]gameState.currentTurn = roomData.currentTurn !== null ? roomData.currentTurn : 0; [cite: 228]
                    gameState.missionMap = roomData.missionMap || [cite_start]{}; [cite: 228]
                    [cite_start]gameState.flippedNumbers = Object.keys(roomData.flippedNumbers || {}).map(Number); [cite: 228]
                    
                    if (roomData.players) {
                        [cite_start]gameState.players = roomData.players; [cite: 229]
                        gameState.playerList = roomData.playerOrderUids || [cite_start][]; [cite: 229]
                    } else {
                        [cite_start]gameState.players = {}; [cite: 230]
                        [cite_start]gameState.playerList = []; [cite: 230]
                    }
                    [cite_start]updatePlayersDisplay(); [cite: 231]
                    // í˜¸ìŠ¤íŠ¸ê°€ ì•„ë‹ˆë”ë¼ë„ Firebaseì—ì„œ ë¯¸ì…˜ ëª©ë¡ì„ ë°›ì•„ì™€ ì—…ë°ì´íŠ¸
                    gameState.missions = roomData.missions || [cite_start][]; [cite: 232]
                    [cite_start]updateMissionsDisplay(); [cite: 232]

                    if (gameState.gameStarted) {
                        [cite_start]document.getElementById('game-setup').style.display = 'none'; [cite: 233]
                        [cite_start]document.getElementById('game-area').style.display = 'block'; [cite: 233]
                        [cite_start]document.getElementById('current-room-code').textContent = gameState.roomCode; [cite: 233]
                        [cite_start]document.getElementById('flipped-numbers-count').textContent = gameState.flippedNumbers.length; [cite: 234]
                        
                        [cite_start]const totalCells = gameState.boardSize * gameState.boardSize; [cite: 234]
                        if (gameState.bingoBoard.length !== totalCells || document.getElementById('bingo-board').children.length !== totalCells) {
                                if (Object.keys(gameState.missionMap).length === totalCells) {
                                    [cite_start]generateBingoBoard(); [cite: 235]
                                }
                        }
                    } else {
                        [cite_start]document.getElementById('game-setup').style.display = 'block'; [cite: 236]
                        [cite_start]document.getElementById('game-area').style.display = 'none'; [cite: 236]
                    }

                    // í„´ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ ë¡œì§ ì œê±°
                    [cite_start]// updateTurnDisplay(); [cite: 237]

                    if (gameState.players[gameState.playerUID] && gameState.players[gameState.playerUID].boardState) {
                        [cite_start]syncBingoBoard(gameState.players[gameState.playerUID].boardState); [cite: 238]
                    } else {
                        [cite_start]syncBingoBoard({}); [cite: 239]
                    }
                    
                    [cite_start]checkBingoPossibility(); [cite: 240]
                    [cite_start]updateBingoCellClickability(); [cite: 240]
                    
                    // ì„ ê³µ í”Œë ˆì´ì–´ ì„¹ì…˜ í™œì„±í™”/ë¹„í™œì„±í™” ë¡œì§ ì œê±°
                    // if (gameState.isHost && gameState.playerList.length > 1) {
                    [cite_start]//     document.getElementById('first-player-section').classList.remove('hidden'); [cite: 241]
                    [cite_start]//     updateFirstPlayerOptions(); [cite: 241]
                    // } else {
                    [cite_start]//     document.getElementById('first-player-section').classList.add('hidden'); [cite: 242]
                    // }

                    if (roomData.winner) {
                        [cite_start]displayWinnerMessage(roomData.winner, roomData.winCondition); [cite: 243]
                        [cite_start]document.getElementById('bingo-button').disabled = true; [cite: 243]
                        // í„´ ì¢…ë£Œ ë²„íŠ¼ disabled ë¡œì§ ì œê±°
                        // document.getElementById('turn-end-button').disabled = true;
                        [cite_start]document.getElementById('bingo-button').style.display = 'none'; [cite: 243]
                        // í„´ ì¢…ë£Œ ë²„íŠ¼ display ë¡œì§ ì œê±°
                        [cite_start]// document.getElementById('turn-end-button').style.display = 'none'; [cite: 244]
                    } else {
                        [cite_start]const winnerOverlay = document.getElementById('winner-overlay'); [cite: 245]
                        [cite_start]if (winnerOverlay) winnerOverlay.remove(); [cite: 245]
                        if (gameState.gameStarted) {
                            [cite_start]document.getElementById('bingo-button').style.display = 'block'; [cite: 246]
                            // í„´ ì¢…ë£Œ ë²„íŠ¼ display ë¡œì§ ì œê±°
                            [cite_start]// document.getElementById('turn-end-button').style.display = 'block'; [cite: 246]
                        }
                    }
                    // ë¯¸ì…˜ ì¶”ê°€ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
                    [cite_start]document.getElementById('add-mission-btn').disabled = !gameState.roomCode; [cite: 247]
                }
            [cite_start]}); [cite: 248]
        }

        // ë¯¸ì…˜ ì¶”ê°€
        async function addMission() {
            if (!gameState.roomCode) {
                [cite_start]showMessage('ë¨¼ì € ë°©ì— ì…ì¥í•˜ê±°ë‚˜ ìƒì„±í•´ì£¼ì„¸ìš”!', 'error'); [cite: 249]
                return;
            }

            [cite_start]const missionInput = document.getElementById('mission-input'); [cite: 250]
            [cite_start]const mission = missionInput.value.trim(); [cite: 250]
            
            if (!mission) {
                [cite_start]showMessage('ë¯¸ì…˜ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error'); [cite: 251]
                return;
            }
            
            // Firebaseì—ì„œ ìµœì‹  ë¯¸ì…˜ ëª©ë¡ì„ ê°€ì ¸ì™€ ì¤‘ë³µ í™•ì¸
            [cite_start]const snapshot = await gameState.roomRef.child('missions').once('value'); [cite: 252]
            const currentMissionsInFirebase = snapshot.val() || [cite_start][]; [cite: 252]

            if (currentMissionsInFirebase.includes(mission)) {
                [cite_start]showMessage('ì´ë¯¸ ì¶”ê°€ëœ ë¯¸ì…˜ì…ë‹ˆë‹¤!', 'error'); [cite: 253]
                return;
            }
            
            try {
                // íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë™ì‹œì„± ë¬¸ì œ ë°©ì§€
                await gameState.roomRef.child('missions').transaction((currentData) => {
                    const newMissions = currentData || [];
                    if (!newMissions.includes(mission)) {
                        newMissions.push(mission);
                    }
                    [cite_start]return newMissions; [cite: 254]
                [cite_start]}); [cite: 255]
                [cite_start]missionInput.value = ''; [cite: 255]
                [cite_start]showMessage('ë¯¸ì…˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨', 'success'); [cite: 255]
                
            } catch (error) {
                [cite_start]showMessage('ë¯¸ì…˜ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error'); [cite: 256]
                [cite_start]console.error('ë¯¸ì…˜ ì¶”ê°€ ì˜¤ë¥˜:', error); [cite: 256]
            }
        }

        // ë¯¸ì…˜ ì‚­ì œ
        async function deleteMission(index) {
            if (!gameState.isHost) {
                [cite_start]showMessage('ë°©ì¥ë§Œ ë¯¸ì…˜ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!', 'error'); [cite: 257]
                return;
            }
            if (!gameState.roomCode) {
                [cite_start]showMessage('ë°©ì— ì…ì¥í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!', 'error'); [cite: 258]
                return;
            }

            try {
                // Firebaseì—ì„œ ìµœì‹  ë¯¸ì…˜ ëª©ë¡ì„ ê°€ì ¸ì™€ ì‚­ì œ
                await gameState.roomRef.child('missions').transaction((currentMissions) => {
                    if (currentMissions && currentMissions.length > index) {
                        [cite_start]const newMissions = currentMissions.filter((_, i) => i !== index); [cite: 259]
                        return newMissions;
                    }
                    return undefined; // íŠ¸ëœì­ì…˜ ì·¨ì†Œ
                [cite_start]}); [cite: 260]
                [cite_start]showMessage('ë¯¸ì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ—‘ï¸', 'success'); [cite: 260]
            } catch (error) {
                [cite_start]showMessage('ë¯¸ì…˜ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error'); [cite: 261]
                [cite_start]console.error('ë¯¸ì…˜ ì‚­ì œ ì˜¤ë¥˜:', error); [cite: 261]
            }
        }

        // ë¯¸ì…˜ ì €ì¥ í•¨ìˆ˜
        function saveMissions() {
            try {
                [cite_start]localStorage.setItem('savedBingoMissions', JSON.stringify(gameState.missions)); [cite: 262]
                [cite_start]showMessage('í˜„ì¬ ë¯¸ì…˜ ëª©ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âœ…', 'success'); [cite: 262]
            } catch (e) {
                [cite_start]showMessage('ë¯¸ì…˜ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'error'); [cite: 263]
                [cite_start]console.error("Failed to save missions to localStorage:", e); [cite: 263]
            }
        }

        // ë¯¸ì…˜ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
        function loadMissions() {
            try {
                [cite_start]const savedMissions = localStorage.getItem('savedBingoMissions'); [cite: 264]
                if (savedMissions) {
                    [cite_start]gameState.missions = JSON.parse(savedMissions); [cite: 265]
                    [cite_start]showMessage('ì €ì¥ëœ ë¯¸ì…˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! ğŸ“', 'success'); [cite: 265]
                } else {
                    [cite_start]gameState.missions = [...defaultMissions]; [cite: 266]
                    [cite_start]showMessage('ì €ì¥ëœ ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ë¯¸ì…˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. â„¹ï¸', 'info'); [cite: 266]
                }
                [cite_start]updateMissionsDisplay(); [cite: 267]
            } catch (e) {
                [cite_start]showMessage('ë¯¸ì…˜ ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. âŒ', 'error'); [cite: 268]
                [cite_start]console.error("Failed to load missions from localStorage:", e); [cite: 268]
                [cite_start]gameState.missions = [...defaultMissions]; [cite: 269]
                [cite_start]updateMissionsDisplay(); [cite: 269]
            }
        }

        // ê²Œì„ ì‹œì‘
        async function startGame() {
            [cite_start]console.log('startGame í•¨ìˆ˜ ì‹œì‘'); [cite: 270]
            if (!gameState.roomCode) {
                [cite_start]showMessage('ë¨¼ì € ë°©ì„ ìƒì„±í•˜ê±°ë‚˜ ì…ì¥í•´ì£¼ì„¸ìš”!', 'error'); [cite: 271]
                return;
            }
            
            [cite_start]const requiredMissions = gameState.boardSize * gameState.boardSize; [cite: 272]
            [cite_start]console.log(`í•„ìš” ë¯¸ì…˜ ìˆ˜: ${requiredMissions}, í˜„ì¬ ë¯¸ì…˜ ìˆ˜: ${gameState.missions.length}`); [cite: 272]
            if (gameState.missions.length < requiredMissions) {
                [cite_start]showMessage(`ë¯¸ì…˜ì´ ìµœì†Œ ${requiredMissions}ê°œ í•„ìš”í•©ë‹ˆë‹¤! í˜„ì¬ ${gameState.missions.length}ê°œ`, 'error'); [cite: 273]
                return;
            }

            if (!gameState.isHost) {
                [cite_start]showMessage('ë°©ì¥ë§Œ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!', 'error'); [cite: 274]
                return;
            }
            
            [cite_start]console.log(`í˜„ì¬ í”Œë ˆì´ì–´ ìˆ˜: ${Object.keys(gameState.players).length}`); [cite: 275]
            if (Object.keys(gameState.players).length < 2) {
                [cite_start]showMessage('ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´ ìµœì†Œ 2ëª… ì´ìƒì˜ í”Œë ˆì´ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤!', 'error'); [cite: 276]
                return;
            }

            // ì„ ê³µ í”Œë ˆì´ì–´ ì„ íƒ ë¡œì§ ì œê±°
            [cite_start]// const firstPlayerSelect = document.getElementById('first-player-select'); [cite: 277]
            [cite_start]// const firstPlayerUid = firstPlayerSelect.value; [cite: 277]
            [cite_start]// console.log(`ì„ íƒëœ ì„ ê³µ í”Œë ˆì´ì–´ UID: ${firstPlayerUid}`); [cite: 277]
            // if (!firstPlayerUid) {
            [cite_start]//     showMessage('ì„ ê³µ í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error'); [cite: 278]
            //     return;
            // }
            
            [cite_start]// const firstPlayerIndex = gameState.playerList.indexOf(firstPlayerUid); [cite: 279]
            // if (firstPlayerIndex === -1) {
            [cite_start]//     showMessage('ì„ íƒëœ ì„ ê³µ í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error'); [cite: 280]
            //     return;
            // }
            
            [cite_start]console.log('ë¯¸ì…˜ ë§µ ìƒì„± ì‹œì‘'); [cite: 281]
            [cite_start]const shuffledMissions = [...gameState.missions].sort(() => Math.random() - 0.5).slice(0, requiredMissions); [cite: 281]
            [cite_start]const shuffledNumbersForMap = Array.from({length: requiredMissions}, (_, i) => i + 1).sort(() => Math.random() - 0.5); [cite: 282]
            [cite_start]const missionMap = {}; [cite: 282]
            for (let i = 0; i < requiredMissions; i++) {
                [cite_start]missionMap[shuffledNumbersForMap[i]] = shuffledMissions[i]; [cite: 283]
            }
            [cite_start]console.log('ìƒì„±ëœ missionMap:', missionMap); [cite: 284]
            try {
                [cite_start]const winCondition = document.querySelector('input[name="win-condition"]:checked').value; [cite: 285]
                [cite_start]const selectedBoardSize = 3; [cite: 285]
                [cite_start]const selectedMaxPlayers = gameState.maxPlayers; [cite: 285]
                
                [cite_start]console.log('Firebase room ì—…ë°ì´íŠ¸ ì‹œë„'); [cite: 286]
                await gameState.roomRef.update({
                    gameStarted: true,
                    winCondition: parseInt(winCondition),
                    boardSize: selectedBoardSize,
                    maxPlayers: selectedMaxPlayers,
                    [cite_start]startedAt: firebase.database.ServerValue.TIMESTAMP, [cite: 287]
                    currentTurn: 0, // ì„ ê³µ ì„ íƒ ë¡œì§ ì œê±°ì— ë”°ë¼ 0ìœ¼ë¡œ ê³ ì •
                    [cite_start]flippedNumbers: {}, [cite: 288]
                    [cite_start]winner: null, [cite: 288]
                    [cite_start]gameEnded: false, [cite: 288]
                    [cite_start]missionMap: missionMap, [cite: 288]
                    [cite_start]bingoClaimed: null [cite: 289]
                [cite_start]}); [cite: 289]
                [cite_start]console.log('Firebase room ì—…ë°ì´íŠ¸ ì„±ê³µ'); [cite: 289]

                const updates = {};
                for (const playerUid in gameState.players) {
                    [cite_start]updates[`players/${playerUid}/boardState`] = {}; [cite: 290]
                }
                [cite_start]await gameState.roomRef.update(updates); [cite: 291]
                [cite_start]console.log('í”Œë ˆì´ì–´ boardState ì´ˆê¸°í™” ì„±ê³µ'); [cite: 291]
                
            } catch (error) {
                [cite_start]showMessage('ê²Œì„ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error'); [cite: 292]
                [cite_start]console.error('ê²Œì„ ì‹œì‘ ì˜¤ë¥˜:', error); [cite: 293]
            }
            [cite_start]console.log('startGame í•¨ìˆ˜ ì¢…ë£Œ'); [cite: 293]
        }

        // ì„ ê³µ í”Œë ˆì´ì–´ ì˜µì…˜ ì—…ë°ì´íŠ¸ (ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)
        // function updateFirstPlayerOptions() {
        [cite_start]//     const firstPlayerSelect = document.getElementById('first-player-select'); [cite: 294]
        [cite_start]//     firstPlayerSelect.innerHTML = '<option value="">ì„ ê³µì„ ì„ íƒí•˜ì„¸ìš”</option>'; [cite: 294]
            
        //     gameState.playerList.forEach(playerUid => {
        //         const playerName = gameState.players[playerUid]?.name || 'Unknown Player';
        //         const option = document.createElement('option');
        //         option.value = playerUid;
        //         option.textContent = playerName;
        [cite_start]//         firstPlayerSelect.appendChild(option); [cite: 295]
        [cite_start]//     }); [cite: 296]
        //     if (gameState.currentTurn !== null && gameState.playerList[gameState.currentTurn]) {
        [cite_start]//         firstPlayerSelect.value = gameState.playerList[gameState.currentTurn]; [cite: 297]
        //     }
        // }

        // í„´ í‘œì‹œ ì—…ë°ì´íŠ¸ (ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)
        // function updateTurnDisplay() {
        [cite_start]//     const turnElement = document.getElementById('current-turn'); [cite: 298]
        //     if (turnElement && gameState.playerList.length > 0) {
        [cite_start]//         const currentPlayerUid = gameState.playerList[gameState.currentTurn]; [cite: 299]
        //         const currentPlayerName = gameState.players[currentPlayerUid]?.name || [cite_start]'ì•Œ ìˆ˜ ì—†ìŒ'; [cite: 299]
        [cite_start]//         const isMyTurn = currentPlayerUid === gameState.playerUID; [cite: 300]
        //         if (isMyTurn) {
        [cite_start]//             turnElement.innerHTML = '<span style="color: #667eea; font-weight: bold;">ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤!</span>'; [cite: 301]
        //         } else {
        [cite_start]//             turnElement.textContent = `${currentPlayerName}ì˜ ì°¨ë¡€`; [cite: 302]
        //         }
        //     }
        // }

        // ë¹™ê³ íŒ UI ë™ê¸°í™”
        function syncBingoBoard(myBoardStateData) {
            [cite_start]const totalCells = gameState.boardSize * gameState.boardSize; [cite: 303]
            if (Object.keys(gameState.missionMap).length === 0 || gameState.bingoBoard.length === 0) {
                if (gameState.gameStarted && Object.keys(gameState.missionMap).length === totalCells) {
                    [cite_start]generateBingoBoard(); [cite: 304]
                } else if (gameState.gameStarted && Object.keys(gameState.missionMap).length === 0) {
                    [cite_start]console.warn("syncBingoBoard: Waiting for missionMap to load..."); [cite: 305]
                    [cite_start]setTimeout(() => syncBingoBoard(myBoardStateData), 100); [cite: 305]
                    return;
                } else {
                    [cite_start]return; [cite: 306]
                }
            }
            
            [cite_start]const bingoBoardElement = document.getElementById('bingo-board'); [cite: 307]
            if (bingoBoardElement.children.length === 0 || bingoBoardElement.children.length !== totalCells) {
                [cite_start]console.warn("syncBingoBoard: Waiting for bingo board DOM to be generated..."); [cite: 308]
                [cite_start]setTimeout(() => syncBingoBoard(myBoardStateData), 50); [cite: 308]
                return;
            }

            [cite_start]const cells = bingoBoardElement.querySelectorAll('.bingo-cell'); [cite: 309]
            for (let i = 0; i < totalCells; i++) {
                [cite_start]const cellInLocalBoard = gameState.bingoBoard[i]; [cite: 310]
                [cite_start]const cellNumber = cellInLocalBoard.number; [cite: 310]
                [cite_start]const missionText = cellInLocalBoard.mission; [cite: 310]

                [cite_start]const isFlippedCommon = gameState.flippedNumbers.includes(cellNumber); [cite: 311]
                [cite_start]const myCellStateFromFirebase = myBoardStateData[cellNumber] ? myBoardStateData[cellNumber].state : 'unflipped'; [cite: 311]
                [cite_start]const cellElement = cells[i]; [cite: 311]
                [cite_start]cellElement.classList.remove('flipped', 'failed'); [cite: 311]

                if (isFlippedCommon) {
                    if (myCellStateFromFirebase === 'flipped') {
                        [cite_start]cellElement.classList.add('flipped'); [cite: 312]
                        [cite_start]cellElement.textContent = missionText; [cite: 312]
                    } else if (myCellStateFromFirebase === 'failed') {
                        [cite_start]cellElement.classList.add('failed'); [cite: 313]
                        [cite_start]cellElement.textContent = missionText; [cite: 313]
                    } else {
                        [cite_start]cellElement.classList.add('flipped'); [cite: 314]
                        [cite_start]cellElement.textContent = missionText; [cite: 314]
                        gameState.roomRef.child(`players/${gameState.playerUID}/boardState/${cellNumber}`).set({
                            state: 'flipped',
                            mission: missionText,
                            changedAt: firebase.database.ServerValue.TIMESTAMP
                        [cite_start]}).catch(error => console.error("Auto-flip update failed:", error)); [cite: 315]
                    }
                } else {
                    [cite_start]cellElement.textContent = cellNumber; [cite: 317]
                }
            }
        }

        // ë¹™ê³  ì…€ í´ë¦­ ê°€ëŠ¥ ì—¬ë¶€ ì—…ë°ì´íŠ¸
        function updateBingoCellClickability() {
            [cite_start]const cells = document.querySelectorAll('.bingo-cell'); [cite: 318]
            // const currentPlayerUid = gameState.playerList[gameState.currentTurn]; // í„´ ê°œë… ì œê±°
            // const isMyTurn = currentPlayerUid === gameState.playerUID; // í„´ ê°œë… ì œê±°
            [cite_start]const gameEnded = gameState.gameStarted && (gameState.roomRef && gameState.roomRef.gameEnded || gameState.roomRef && gameState.roomRef.winner); [cite: 320]

            cells.forEach((cellElement, index) => {
                const cellNumber = gameState.bingoBoard[index].number;
                const isFlippedCommon = gameState.flippedNumbers.includes(cellNumber);

                if (gameEnded) {
                    [cite_start]cellElement.style.pointerEvents = 'none'; [cite: 321]
                    [cite_start]cellElement.style.opacity = '0.7'; [cite: 321]
                } else { // í„´ ê°œë… ì—†ì´ í•­ìƒ í´ë¦­ ê°€ëŠ¥
                    if (!isFlippedCommon) { // ë’¤ì§‘íˆì§€ ì•Šì€ ì…€ì€ í´ë¦­ ê°€ëŠ¥
                        cellElement.style.pointerEvents = 'auto';
                        cellElement.style.opacity = '1';
                    } else { // ì´ë¯¸ ë’¤ì§‘íŒ ì…€ë„ ë‹¤ì‹œ í´ë¦­í•˜ì—¬ ìƒíƒœ ë³€ê²½ ê°€ëŠ¥í•˜ë„ë¡
                        cellElement.style.pointerEvents = 'auto';
                        cellElement.style.opacity = '1';
                    }
                }
            });
        }

        // ë¹™ê³  ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        function checkBingoPossibility() {
            [cite_start]const board = gameState.bingoBoard; [cite: 328]
            [cite_start]const size = gameState.boardSize; [cite: 328]
            [cite_start]const requiredLines = gameState.winCondition; [cite: 328]
            [cite_start]let completedLines = 0; [cite: 328]
            [cite_start]const bingoButton = document.getElementById('bingo-button'); [cite: 328]
            // const turnEndButton = document.getElementById('turn-end-button'); [cite_start]// í„´ ì¢…ë£Œ ë²„íŠ¼ ì œê±° [cite: 329]
            // const currentPlayerUid = gameState.playerList[gameState.currentTurn]; [cite_start]// í„´ ê°œë… ì œê±° [cite: 329]
            // const isMyTurn = currentPlayerUid === gameState.playerUID; [cite_start]// í„´ ê°œë… ì œê±° [cite: 330]

            if (!gameState.gameStarted || !gameState.roomRef) {
                [cite_start]gameState.canClaimBingo = false; [cite: 330]
                [cite_start]bingoButton.disabled = true; [cite: 331]
                // turnEndButton.disabled = true; [cite_start]// í„´ ì¢…ë£Œ ë²„íŠ¼ ì œê±° [cite: 331]
                return;
            }

            gameState.roomRef.once('value').then(snapshot => {
                [cite_start]const roomData = snapshot.val(); [cite: 331]
                [cite_start]if (!roomData) return; [cite: 331]

                if (roomData.gameEnded || roomData.winner) {
                    [cite_start]bingoButton.disabled = true; [cite: 332]
                    // turnEndButton.disabled = true; [cite_start]// í„´ ì¢…ë£Œ ë²„íŠ¼ ì œê±° [cite: 332]
                    [cite_start]bingoButton.style.display = 'none'; [cite: 332]
                    // turnEndButton.style.display = 'none'; [cite_start]// í„´ ì¢…ë£Œ ë²„íŠ¼ ì œê±° [cite: 332]
                    [cite_start]return; [cite: 332]
                } else {
                    [cite_start]bingoButton.style.display = 'block'; [cite: 332]
                    // turnEndButton.style.display = 'block'; [cite_start]// í„´ ì¢…ë£Œ ë²„íŠ¼ ì œê±° [cite: 332]
                }

                // ë¹™ê³  ë¼ì¸ ì²´í¬
                for (let i = 0; i < size; i++) {
                    [cite_start]let rowComplete = true; [cite: 333]
                    for (let j = 0; j < size; j++) {
                        [cite_start]const index = i * size + j; [cite: 333]
                        if (!board[index] || !roomData.players[gameState.playerUID] || !roomData.players[gameState.playerUID].boardState || roomData.players[gameState.playerUID].boardState[board[index].number]?.state !== 'flipped') {
                            [cite_start]rowComplete = false; [cite: 334]
                            [cite_start]break; [cite: 335]
                        }
                    }
                    [cite_start]if (rowComplete) completedLines++; [cite: 336]
                }

                for (let j = 0; j < size; j++) {
                    [cite_start]let colComplete = true; [cite: 337]
                    for (let i = 0; i < size; i++) {
                        [cite_start]const index = i * size + j; [cite: 338]
                        if (!board[index] || !roomData.players[gameState.playerUID] || !roomData.players[gameState.playerUID].boardState || roomData.players[gameState.playerUID].boardState[board[index].number]?.state !== 'flipped') {
                            [cite_start]colComplete = false; [cite: 339]
                            [cite_start]break; [cite: 339]
                        }
                    }
                    [cite_start]if (colComplete) completedLines++; [cite: 340]
                }

                [cite_start]let diag1Complete = true; [cite: 341]
                for (let i = 0; i < size; i++) {
                    [cite_start]const index = i * size + i; [cite: 342]
                    if (!board[index] || !roomData.players[gameState.playerUID] || !roomData.players[gameState.playerUID].boardState || roomData.players[gameState.playerUID].boardState[board[index].number]?.state !== 'flipped') {
                        [cite_start]diag1Complete = false; [cite: 343]
                        [cite_start]break; [cite: 343]
                    }
                }
                [cite_start]if (diag1Complete) completedLines++; [cite: 344]
                [cite_start]let diag2Complete = true; [cite: 344]
                for (let i = 0; i < size; i++) {
                    [cite_start]const index = i * size + (size - 1 - i); [cite: 345]
                    if (!board[index] || !roomData.players[gameState.playerUID] || !roomData.players[gameState.playerUID].boardState || roomData.players[gameState.playerUID].boardState[board[index].number]?.state !== 'flipped') {
                        [cite_start]diag2Complete = false; [cite: 346]
                        [cite_start]break; [cite: 346]
                    }
                }
                [cite_start]if (diag2Complete) completedLines++; [cite: 347]
                [cite_start]console.log(`${gameState.playerName}: í˜„ì¬ ì™„ì„±ëœ ë¼ì¸ ìˆ˜ = ${completedLines}`); [cite: 347]

                if (completedLines >= requiredLines) {
                    [cite_start]gameState.canClaimBingo = true; [cite: 348]
                    [cite_start]bingoButton.disabled = roomData.gameEnded || roomData.winner; [cite: 349] 
                } else {
                    [cite_start]gameState.canClaimBingo = false; [cite: 350]
                    [cite_start]bingoButton.disabled = true; [cite: 350]
                }

                // í„´ ì¢…ë£Œ ë²„íŠ¼ ê´€ë ¨ ë¡œì§ ì œê±°
                // turnEndButton.disabled = !isMyTurn || roomData.gameEnded || roomData.winner || [cite_start]!gameState.hasMadeMoveInTurn; [cite: 351]

            }).catch(error => {
                [cite_start]console.error("Error checking bingo possibility:", error); [cite: 352]
                [cite_start]showMessage("ë¹™ê³ /í„´ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ!", "error"); [cite: 352]
                [cite_start]bingoButton.disabled = true; [cite: 352]
                // turnEndButton.disabled = true; [cite_start]// í„´ ì¢…ë£Œ ë²„íŠ¼ ì œê±° [cite: 352]
            [cite_start]}); [cite: 352]
        }

        // í„´ ì¢…ë£Œ í•¨ìˆ˜ ì œê±°
        // async function turnEnd() {
        [cite_start]//     const currentPlayerUid = gameState.playerList[gameState.currentTurn]; [cite: 353]
        //     if (currentPlayerUid !== gameState.playerUID) {
        [cite_start]//         showMessage('ë‹¹ì‹ ì˜ ì°¨ë¡€ê°€ ì•„ë‹™ë‹ˆë‹¤!', 'error'); [cite: 354]
        //         return;
        //     }

        [cite_start]//     const roomSnapshot = await gameState.roomRef.once('value'); [cite: 355]
        [cite_start]//     const roomData = roomSnapshot.val(); [cite: 355]

        //     if (roomData.gameEnded || roomData.winner) {
        [cite_start]//         showMessage('ê²Œì„ì€ ì´ë¯¸ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'error'); [cite: 356]
        //         return;
        //     }

        //     if (!gameState.hasMadeMoveInTurn) {
        [cite_start]//         showMessage('ì…€ì„ í•˜ë‚˜ë¼ë„ ë’¤ì§‘ì–´ì•¼ í„´ì„ ì¢…ë£Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!', 'error'); [cite: 357]
        //         return;
        //     }

        //     try {
        [cite_start]//         const nextTurn = (gameState.currentTurn + 1) % gameState.playerList.length; [cite: 358]
        //         await gameState.roomRef.update({
        //             currentTurn: nextTurn
        [cite_start]//         }); [cite: 359]
        [cite_start]//         showMessage('í„´ì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤.', 'info'); [cite: 359]
        [cite_start]//         gameState.hasMadeMoveInTurn = false; [cite: 359]
        [cite_start]//         document.getElementById('turn-end-button').disabled = true; [cite: 359]
        [cite_start]//         document.getElementById('bingo-button').disabled = true; [cite: 360]
        //     } catch (error) {
        [cite_start]//         showMessage('í„´ ì¢…ë£Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error'); [cite: 361]
        [cite_start]//         console.error('Turn End Error:', error); [cite: 361]
        //     }
        // }

        // ë¹™ê³  ìŠ¹ë¦¬ ì£¼ì¥
        async function claimBingo() {
            if (!gameState.canClaimBingo) {
                [cite_start]showMessage('ë¹™ê³ ë¥¼ ì£¼ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¡°ê±´ì„ ë‹¤ì‹œ í™•ì¸í•˜ì„¸ìš”!', 'error'); [cite: 362]
                return;
            }
            
            [cite_start]const roomSnapshot = await gameState.roomRef.once('value'); [cite: 363]
            [cite_start]const roomData = roomSnapshot.val(); [cite: 363]

            if (roomData.gameEnded || roomData.winner) {
                [cite_start]showMessage('ê²Œì„ì€ ì´ë¯¸ ì¢…ë£Œë˜ì—ˆê±°ë‚˜ ìŠ¹ìê°€ ê²°ì •ë˜ì—ˆìŠµë‹ˆë‹¤!', 'error'); [cite: 364]
                return;
            }
            
            if (roomData.bingoClaimed) {
                [cite_start]showMessage('ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì´ë¯¸ ë¹™ê³ ë¥¼ ì£¼ì¥í–ˆìŠµë‹ˆë‹¤!', 'error'); [cite: 365]
                return;
            }

            try {
                const result = await gameState.roomRef.child('bingoClaimed').transaction((currentClaim) => {
                    if (currentClaim === null) {
                        return {
                            [cite_start]claimerUid: gameState.playerUID, [cite: 366]
                            [cite_start]claimerName: gameState.playerName, [cite: 366]
                            [cite_start]timestamp: firebase.database.ServerValue.TIMESTAMP [cite: 367]
                        [cite_start]}; [cite: 367]
                    } else {
                        [cite_start]return undefined; [cite: 367]
                    }
                [cite_start]}); [cite: 368]
                if (result.committed) {
                    await gameState.roomRef.update({
                        winner: gameState.playerName,
                        winnerUid: gameState.playerUID,
                        gameEnded: true,
                        [cite_start]endedAt: firebase.database.ServerValue.TIMESTAMP [cite: 369]
                    [cite_start]}); [cite: 370]
                    [cite_start]showMessage('ğŸ‰ ë¹™ê³ ë¥¼ ì£¼ì¥í–ˆìŠµë‹ˆë‹¤! ë‹¹ì‹ ì´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤!', 'success'); [cite: 370]
                } else {
                    [cite_start]showMessage('ì•—! ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ë¨¼ì € ë¹™ê³ ë¥¼ ì£¼ì¥í–ˆìŠµë‹ˆë‹¤!', 'error'); [cite: 371]
                }
                [cite_start]document.getElementById('bingo-button').disabled = true; [cite: 372]
                [cite_start]document.getElementById('bingo-button').style.display = 'none'; [cite: 372]
                // í„´ ì¢…ë£Œ ë²„íŠ¼ display ë¡œì§ ì œê±°
                [cite_start]// document.getElementById('turn-end-button').style.display = 'none'; [cite: 372]
            } catch (error) {
                [cite_start]showMessage('ë¹™ê³  ì£¼ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error'); [cite: 373]
                [cite_start]console.error('Claim Bingo Error:', error); [cite: 373]
            }
        }

        // ìŠ¹ë¦¬ ë©”ì‹œì§€ í‘œì‹œ
        function displayWinnerMessage(winnerName, winCondition) {
            if (document.getElementById('winner-overlay')) {
                [cite_start]return; [cite: 374]
            }

            const overlay = document.createElement('div');
            [cite_start]overlay.classList.add('winner-overlay'); [cite: 375]
            [cite_start]overlay.id = 'winner-overlay'; [cite: 375]
            [cite_start]const messageBox = document.createElement('div'); [cite: 375]
            [cite_start]messageBox.classList.add('winner-message'); [cite: 375]
            messageBox.innerHTML = `
                <p class="emoji">ğŸ‰ğŸ†</p>
                <p class="winner-text gradient-text">${winnerName}ë‹˜</p>
                <p class="winner-text gradient-text">${winCondition}ì¤„ ë¹™ê³ ë¡œ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!</p>
                <button class="btn btn-primary" onclick="closeWinnerMessage()">í™•ì¸</button>
            [cite_start]`; [cite: 376]
            [cite_start]overlay.appendChild(messageBox); [cite: 376]
            [cite_start]document.body.appendChild(overlay); [cite: 376]
        }

        // ìŠ¹ë¦¬ ë©”ì‹œì§€ ë‹«ê¸°
        function closeWinnerMessage() {
            [cite_start]const overlay = document.getElementById('winner-overlay'); [cite: 377]
            if (overlay) {
                [cite_start]overlay.remove(); [cite: 378]
                if (confirm('ì„¤ì • í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    [cite_start]backToSetup(); [cite: 379]
                }
            }
        }

        // ì„¤ì • í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function backToSetup() {
            [cite_start]document.getElementById('game-setup').style.display = 'block'; [cite: 380]
            [cite_start]document.getElementById('game-area').style.display = 'none'; [cite: 380]
            
            if (gameState.roomRef && gameState.playerUID) {
                [cite_start]gameState.roomRef.off(); [cite: 381]
                // í”Œë ˆì´ì–´ê°€ ë°©ì„ ë‚˜ê°ˆ ë•Œë§Œ Firebaseì—ì„œ í”Œë ˆì´ì–´ ì •ë³´ ì‚­ì œ
                // í˜¸ìŠ¤íŠ¸ê°€ ë‚˜ê°ˆ ë•Œ ë°© ì „ì²´ë¥¼ ì‚­ì œí•˜ëŠ” ë¡œì§ì€ ì¶”ê°€í•˜ì§€ ì•ŠìŒ (ê²Œì„ì˜ ì¼ê´€ì„±ì„ ìœ„í•´)
                gameState.roomRef.child('players').child(gameState.playerUID).remove()
                    .then(() => {
                        [cite_start]console.log(`í”Œë ˆì´ì–´ ${gameState.playerName}ì´(ê°€) ë°©ì„ ë‚˜ê°‘ë‹ˆë‹¤. UID: ${gameState.playerUID}`); [cite: 382]
                        // playerOrderUids ë°°ì—´ì—ì„œë„ í•´ë‹¹ UID ì œê±°
                        gameState.roomRef.child('playerOrderUids').transaction((currentUids) => {
                            if (currentUids) {
                                [cite_start]return currentUids.filter(uid => uid !== gameState.playerUID); [cite: 383]
                            }
                            [cite_start]return []; [cite: 384]
                        [cite_start]}); [cite: 384]
                    })
                    .catch(error => {
                        [cite_start]console.error("ë°© ë‚˜ê°€ê¸° ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error); [cite: 385]
                    [cite_start]}); [cite: 385]
            }
            
            [cite_start]const oldPlayerUID = gameState.playerUID; [cite: 386]
            gameState = {
                [cite_start]isHost: false, [cite: 386]
                [cite_start]roomCode: '', [cite: 386]
                [cite_start]playerName: '', [cite: 386]
                [cite_start]playerUID: oldPlayerUID, [cite: 387]
                [cite_start]players: {}, [cite: 387]
                [cite_start]missions: [], [cite: 387]
                isAuthReady: true, // ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€
                [cite_start]winCondition: 1, [cite: 387]
                [cite_start]boardSize: 3, [cite: 388]
                [cite_start]maxPlayers: 2, [cite: 388]
                [cite_start]gameStarted: false, [cite: 388]
                [cite_start]bingoBoard: [], [cite: 388]
                currentTurn: 0, // í„´ ê°œë… ì œê±° í›„ì—ë„ ì´ˆê¸°í™”ëŠ” 0ìœ¼ë¡œ
                [cite_start]playerList: [], [cite: 388]
                [cite_start]roomRef: null, [cite: 389]
                [cite_start]missionMap: {}, [cite: 389]
                [cite_start]canClaimBingo: false, [cite: 389]
                [cite_start]flippedNumbers: [], [cite: 389]
                hasMadeMoveInTurn: false // ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•Šì§€ë§Œ ì´ˆê¸°í™”ëŠ” ìœ ì§€
            [cite_start]}; [cite: 390]
            // UI ì´ˆê¸°í™”
            [cite_start]document.getElementById('players-list').innerHTML = '<div class="loading">ë°©ì— ì…ì¥í•˜ë©´ ì°¸ê°€ìê°€ í‘œì‹œë©ë‹ˆë‹¤</div>'; [cite: 390]
            [cite_start]document.getElementById('missions-list').innerHTML = `<div style="text-align: center; color: #a0aec0; padding: 20px;">ë¯¸ì…˜ì„ ì¶”ê°€í•´ì£¼ì„¸ìš” (ìµœì†Œ ${gameState.boardSize * gameState.boardSize}ê°œ í•„ìš”)</div>`; [cite: 391]
            [cite_start]document.getElementById('current-mission-count').textContent = 'í˜„ì¬ ë“±ë¡ëœ ë¯¸ì…˜: 0ê°œ'; [cite: 392]
            [cite_start]document.getElementById('share-section').classList.add('hidden'); [cite: 392]
            [cite_start]document.getElementById('join-room-section').classList.add('hidden'); [cite: 392]
            [cite_start]document.getElementById('auto-join-hint').classList.add('hidden'); [cite: 392]
            
            [cite_start]document.getElementById('create-room-btn').classList.remove('hidden-by-url-param'); [cite: 392]
            [cite_start]document.getElementById('max-players-create-group').classList.remove('hidden-by-url-param'); [cite: 393]
            [cite_start]document.getElementById('main-action-buttons').classList.remove('hidden-by-url-param'); [cite: 393]

            [cite_start]document.getElementById('room-code').readOnly = false; [cite: 393]
            // ì„ ê³µ í”Œë ˆì´ì–´ ì„¹ì…˜ ìˆ¨ê¹€ ìœ ì§€
            [cite_start]document.getElementById('first-player-section').classList.add('hidden'); [cite: 242] // ì´ ë¶€ë¶„ì€ ì›ë˜ hiddenì´ì—ˆìœ¼ë¯€ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤.
            [cite_start]document.getElementById('player-name').value = ''; [cite: 393]
            [cite_start]document.getElementById('room-code').value = ''; [cite: 393]
            [cite_start]document.getElementById('bingo-button').style.display = 'block'; [cite: 393]
            [cite_start]document.getElementById('bingo-button').disabled = true; [cite: 394]
            // í„´ ì¢…ë£Œ ë²„íŠ¼ display ë° disabled ë¡œì§ ì œê±°
            [cite_start]// document.getElementById('turn-end-button').style.display = 'block'; [cite: 394]
            [cite_start]// document.getElementById('turn-end-button').disabled = true; [cite: 394]
            
            [cite_start]const winnerOverlay = document.getElementById('winner-overlay'); [cite: 394]
            if (winnerOverlay) {
                [cite_start]winnerOverlay.remove(); [cite: 395]
            }

            [cite_start]document.getElementById('size-3').checked = true; [cite: 395]
            [cite_start]document.getElementById('win-1').checked = true; [cite: 396]
            [cite_start]document.getElementById('max-players-create').value = 2; [cite: 396]
            [cite_start]document.getElementById('flipped-numbers-count').textContent = '0'; [cite: 396]
            [cite_start]document.getElementById('game-options-section').classList.remove('hidden'); [cite: 396]

            [cite_start]loadMissions(); [cite: 396]
            [cite_start]updateButtonStates(); [cite: 396]
        }

        // ë°© ì½”ë“œ ìƒì„±
        function generateRoomCode() {
            [cite_start]const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'; [cite: 397]
            [cite_start]let result = ''; [cite: 397]
            for (let i = 0; i < 6; i++) {
                [cite_start]result += chars.charAt(Math.floor(Math.random() * chars.length)); [cite: 398]
            }
            [cite_start]return result; [cite: 399]
        }

        // í”Œë ˆì´ì–´ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updatePlayersDisplay() {
            [cite_start]const playersList = document.getElementById('players-list'); [cite: 400]
            [cite_start]const playersArray = Object.values(gameState.players); [cite: 400]
            
            if (playersArray.length === 0) {
                [cite_start]playersList.innerHTML = '<div class="loading">ë°©ì— ì…ì¥í•˜ë©´ ì°¸ê°€ìê°€ í‘œì‹œë©ë‹ˆë‹¤</div>'; [cite: 401]
                return;
            }
            
            // playerList (UID ìˆœì„œ)ì— ë”°ë¼ ì •ë ¬í•˜ì—¬ í‘œì‹œ
            const sortedPlayers = gameState.playerList
                .map(uid => gameState.players[uid])
                [cite_start].filter(player => player !== undefined); [cite: 402] // ë°©ì„ ë‚˜ê°„ í”Œë ˆì´ì–´ëŠ” ì œì™¸

            playersList.innerHTML = sortedPlayers.map(player =>
                `<div class="player-item ${player.isHost ? 'host' : ''}">
                    ${player.isHost ? 'ğŸ‘‘' : 'ğŸ‘¤'} ${player.name} ${player.isHost ? '(ë°©ì¥)' : ''}
                </div>`
            [cite_start]).join(''); [cite: 403]
            [cite_start]const startBtn = document.getElementById('start-game-btn'); [cite: 403]
            if (gameState.isHost) {
                [cite_start]startBtn.style.display = 'block'; [cite: 404]
                [cite_start]startBtn.textContent = 'ğŸ® ê²Œì„ ì‹œì‘!'; [cite: 404]
                [cite_start]startBtn.disabled = false; [cite: 404]
            } else {
                [cite_start]startBtn.style.display = 'block'; [cite: 405]
                [cite_start]startBtn.textContent = 'ë°©ì¥ì´ ê²Œì„ì„ ì‹œì‘í•˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...'; [cite: 405]
                [cite_start]startBtn.disabled = true; [cite: 406]
            }
        }

        // ë¯¸ì…˜ ëª©ë¡ UI ì—…ë°ì´íŠ¸
        function updateMissionsDisplay() {
            [cite_start]const missionsList = document.getElementById('missions-list'); [cite: 407]
            [cite_start]const requiredMissions = gameState.boardSize * gameState.boardSize; [cite: 407]

            if (gameState.missions.length === 0) {
                [cite_start]missionsList.innerHTML = `<div style="text-align: center; color: #a0aec0; padding: 20px;">ë¯¸ì…˜ì„ ì¶”ê°€í•´ì£¼ì„¸ìš” (ìµœì†Œ ${requiredMissions}ê°œ í•„ìš”)</div>`; [cite: 408]
            } else {
                missionsList.innerHTML = gameState.missions.map((mission, index) =>
                    `<div class="mission-item">
                        <span>ğŸ“Œ ${mission}</span>
                        ${gameState.isHost ? `<button class="delete-btn" onclick="deleteMission(${index})">ì‚­ì œ</button>` : ''}
                    [cite_start]</div>` [cite: 409]
                [cite_start]).join(''); [cite: 410]
            }

            [cite_start]document.getElementById('current-mission-count').textContent = `í˜„ì¬ ë“±ë¡ëœ ë¯¸ì…˜: ${gameState.missions.length}ê°œ`; [cite: 411]
        }

        // ë¹™ê³ íŒ ìƒì„±
        function generateBingoBoard() {
            [cite_start]const size = gameState.boardSize; [cite: 412]
            [cite_start]const totalCells = size * size; [cite: 412]

            if (Object.keys(gameState.missionMap).length === 0 || Object.keys(gameState.missionMap).length !== totalCells) {
                [cite_start]console.warn('generateBingoBoard: Mission map is not fully loaded yet or size mismatch. Retrying in 100ms...'); [cite: 413]
                [cite_start]setTimeout(generateBingoBoard, 100); [cite: 413]
                return;
            }
            
            [cite_start]const bingoBoardElement = document.getElementById('bingo-board'); [cite: 414]
            if (gameState.bingoBoard.length === totalCells && bingoBoardElement.children.length === totalCells && bingoBoardElement.classList.contains(`size-${size}`)) {
                [cite_start]bingoBoardElement.className = `bingo-board size-${size}`; [cite: 415]
                return;
            }

            [cite_start]const numbers = Array.from({length: totalCells}, (_, i) => i + 1); [cite: 416]
            [cite_start]const shuffledNumbers = numbers.sort(() => Math.random() - 0.5); [cite: 416]
            
            gameState.bingoBoard = shuffledNumbers.map((num) => ({
                number: num,
                state: 'unflipped',
                mission: gameState.missionMap[num] || `ë¯¸ì…˜ ${num}`
            [cite_start]})); [cite: 417]
            [cite_start]bingoBoardElement.className = `bingo-board size-${size}`; [cite: 417]
            bingoBoardElement.innerHTML = gameState.bingoBoard.map((cell, index) =>
                `<div class="bingo-cell" onclick="flipCell(${index})">${cell.number}</div>`
            [cite_start]).join(''); [cite: 418]
            [cite_start]updateBingoCellClickability(); [cite: 418]
        }

        // ì…€ ë’¤ì§‘ê¸°
        async function flipCell(index) {
            [cite_start]const roomSnapshot = await gameState.roomRef.once('value'); [cite: 419]
            [cite_start]const roomData = roomSnapshot.val(); [cite: 419]
            
            if (roomData.gameEnded || roomData.winner) {
                [cite_start]showMessage('ê²Œì„ì´ ì´ë¯¸ ì¢…ë£Œë˜ì—ˆê±°ë‚˜ ìŠ¹ìê°€ ê²°ì •ë˜ì—ˆìŠµë‹ˆë‹¤!', 'error'); [cite: 420]
                return;
            }
            
            [cite_start]const selectedNumber = gameState.bingoBoard[index].number; [cite: 421]
            [cite_start]const missionToAssign = gameState.bingoBoard[index].mission; [cite: 421]
            // const currentPlayerUidInRoom = gameState.playerList[gameState.currentTurn]; [cite_start]// í„´ ê°œë… ì œê±° [cite: 421]
            // const isMyTurn = gameState.playerUID === currentPlayerUidInRoom; [cite_start]// í„´ ê°œë… ì œê±° [cite: 422]

            try {
                [cite_start]const isFlippedCommon = gameState.flippedNumbers.includes(selectedNumber); [cite: 423]
                const myCurrentState = roomData.players[gameState.playerUID]?.boardState?.[selectedNumber]?.state || [cite_start]'unflipped'; [cite: 423]

                if (!isFlippedCommon) { // ì•„ì§ ë’¤ì§‘íˆì§€ ì•Šì€ ì…€ì¸ ê²½ìš°
                    // í„´ í™•ì¸ ë¡œì§ ì œê±°
                    [cite_start]// if (isMyTurn) { [cite: 424]
                    //     if (gameState.hasMadeMoveInTurn) {
                    [cite_start]//         showMessage('í•œ í„´ì— í•˜ë‚˜ì˜ ìˆ«ìë§Œ ë’¤ì§‘ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!', 'error'); [cite: 424]
                    //         return;
                    //     }

                        const flippedResult = await gameState.roomRef.child('flippedNumbers').child(selectedNumber).transaction((currentValue) => {
                            if (currentValue === null) {
                                [cite_start]return true; [cite: 425]
                            }
                            [cite_start]return undefined; [cite: 426]
                        [cite_start]}); [cite: 426]
                        if (!flippedResult.committed) {
                            [cite_start]showMessage('ì´ë¯¸ ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì´ ìˆ«ìë¥¼ ë’¤ì§‘ì—ˆê±°ë‚˜ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error'); [cite: 427]
                            return;
                        }
                        // gameState.hasMadeMoveInTurn = true; [cite_start]// í„´ ê°œë… ì œê±° [cite: 428]
                    // } else {
                    //     const currentPlayerNameForMsg = gameState.players[currentPlayerUidInRoom]?.name || [cite_start]'ì•Œ ìˆ˜ ì—†ëŠ” í”Œë ˆì´ì–´'; [cite: 429]
                    [cite_start]//     showMessage(`${currentPlayerNameForMsg}ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ìˆ«ìë¥¼ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`, 'error'); [cite: 430]
                    [cite_start]//     return; [cite: 430]
                    // }
                }

                [cite_start]const myBoardStateRef = gameState.roomRef.child(`players/${gameState.playerUID}/boardState/${selectedNumber}`); [cite: 431]
                const boardStateResult = await myBoardStateRef.transaction((currentMyStateData) => {
                    [cite_start]let stateForMeInFirebase = currentMyStateData ? currentMyStateData.state : 'unflipped'; [cite: 431]
                    [cite_start]let nextStateForMe; [cite: 431]

                    if (isFlippedCommon) { // ì´ë¯¸ ê³µí†µìœ¼ë¡œ ë’¤ì§‘íŒ ì…€
                        if (stateForMeInFirebase === 'flipped') { // íŒŒë€ìƒ‰ -> ë¹¨ê°„ìƒ‰
                            nextStateForMe = 'failed';
                        } else if (stateForMeInFirebase === 'failed') { // ë¹¨ê°„ìƒ‰ -> íŒŒë€ìƒ‰
                            [cite_start]nextStateForMe = 'flipped'; [cite: 433]
                        } else { // ê¸°ë³¸ê°’(unflipped) -> íŒŒë€ìƒ‰ (ë‹¤ë¥¸ ì‚¬ëŒì´ ë’¤ì§‘ì€ ê±¸ ì²˜ìŒ ë³´ëŠ” ê²½ìš°)
                            [cite_start]nextStateForMe = 'flipped'; [cite: 433]
                        }
                    } else { // ì•„ì§ ê³µí†µìœ¼ë¡œ ë’¤ì§‘íˆì§€ ì•Šì€ ì…€ (ì§€ê¸ˆ ë§‰ ë’¤ì§‘ìœ¼ë ¤ëŠ” ê²½ìš°)
                        if (stateForMeInFirebase === 'unflipped') { // ë’¤ì§‘íˆì§€ ì•ŠìŒ -> íŒŒë€ìƒ‰
                            [cite_start]nextStateForMe = 'flipped'; [cite: 434]
                        } else if (stateForMeInFirebase === 'failed') { // ë¹¨ê°„ìƒ‰(ì´ì „ ê²Œì„ ë“±) -> ë’¤ì§‘íˆì§€ ì•ŠìŒ (ìƒˆë¡œìš´ ê²Œì„ì´ë¼ ë¦¬ì…‹)
                            [cite_start]nextStateForMe = 'unflipped'; [cite: 435]
                        } else { // ê·¸ ì™¸ì˜ ê²½ìš° (ì˜ˆì™¸ ì²˜ë¦¬)
                            [cite_start]return undefined; [cite: 436]
                        }
                    }
                    
                    return {
                        [cite_start]state: nextStateForMe, [cite: 437]
                        [cite_start]mission: missionToAssign, [cite: 437]
                        [cite_start]changedAt: firebase.database.ServerValue.TIMESTAMP [cite: 438]
                    [cite_start]}; [cite: 438]
                [cite_start]}); [cite: 438]

                if (!boardStateResult.committed) {
                    [cite_start]showMessage('ë‚´ ë¹™ê³ íŒ ì¹¸ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!', 'error'); [cite: 439]
                }
                
            } catch (error) {
                [cite_start]showMessage('ì…€ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error'); [cite: 440]
                [cite_start]console.error('Firebase Transaction Error:', error); [cite: 440]
            }
        }

        // ê³µìœ  ë§í¬ ë³µì‚¬
        function copyShareLink() {
            [cite_start]const shareLinkInput = document.getElementById('share-link'); [cite: 441]
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shareLinkInput.value)
                    .then(() => {
                        showMessage('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹', 'success');
                    [cite_start]}) [cite: 442]
                    .catch(err => {
                        [cite_start]console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err); [cite: 442]
                        try {
                            [cite_start]shareLinkInput.select(); [cite: 443]
                            [cite_start]shareLinkInput.setSelectionRange(0, 99999); [cite: 443]
                            [cite_start]document.execCommand('copy'); [cite: 443]
                            [cite_start]showMessage('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (êµ¬í˜• ë°©ì‹) ğŸ“‹', 'success'); [cite: 444]
                        } catch (execErr) {
                            [cite_start]prompt('ë§í¬ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•˜ì„¸ìš”:', shareLinkInput.value); [cite: 444]
                        }
                    [cite_start]}); [cite: 445]
            } else {
                try {
                    [cite_start]shareLinkInput.select(); [cite: 446]
                    [cite_start]shareLinkInput.setSelectionRange(0, 99999); [cite: 446]
                    [cite_start]document.execCommand('copy'); [cite: 446]
                    [cite_start]showMessage('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (êµ¬í˜• ë°©ì‹) ğŸ“‹', 'success'); [cite: 447]
                } catch (execErr) {
                    [cite_start]prompt('ë§í¬ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•˜ì„¸ìš”:', shareLinkInput.value); [cite: 447]
                }
            }
        }

        // URL íŒŒë¼ë¯¸í„° í™•ì¸ ë° ìë™ ì…ì¥
        function checkURLParams() {
            [cite_start]const urlParams = new URLSearchParams(window.location.search); [cite: 448]
            [cite_start]const roomCode = urlParams.get('room'); [cite: 448]
            
            if (roomCode) {
                [cite_start]const upperRoomCode = roomCode.toUpperCase(); [cite: 449]
                [cite_start]console.log('ğŸ¯ URLì—ì„œ ë°© ì½”ë“œ ë°œê²¬:', upperRoomCode); [cite: 449]
                
                setTimeout(() => performAutoJoin(upperRoomCode), 0);
                [cite_start]return true; [cite: 450]
            } else {
                [cite_start]console.log('âŒ URLì— ë°© ì½”ë“œ ì—†ìŒ'); [cite: 451]
                return false;
            }
        }

        // ìë™ ì…ì¥ ì‹¤í–‰
        function performAutoJoin(roomCode) {
            [cite_start]console.log('ğŸš€ ìë™ ì…ì¥ í”„ë¡œì„¸ìŠ¤ ì‹œì‘:', roomCode); [cite: 452]
            [cite_start]const joinSection = document.getElementById('join-room-section'); [cite: 452]
            [cite_start]const roomCodeInput = document.getElementById('room-code'); [cite: 452]
            [cite_start]const nameInput = document.getElementById('player-name'); [cite: 453]
            [cite_start]const hintElement = document.getElementById('auto-join-hint'); [cite: 453]
            [cite_start]const createRoomControls = document.querySelector('.create-room-controls'); [cite: 453]
            [cite_start]const mainActionButtons = document.getElementById('main-action-buttons'); [cite: 453]
            [cite_start]const gameOptionsSection = document.getElementById('game-options-section'); [cite: 454]

            if (!joinSection || !roomCodeInput || !nameInput || !hintElement || !createRoomControls || !mainActionButtons || !gameOptionsSection) {
                [cite_start]console.error('âŒ í•„ìš”í•œ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ. ì¬ì‹œë„í•©ë‹ˆë‹¤.'); [cite: 454]
                [cite_start]setTimeout(() => performAutoJoin(roomCode), 100); [cite: 454]
                return;
            }
            
            [cite_start]console.log('âœ… DOM ìš”ì†Œ ëª¨ë‘ ì¤€ë¹„ë¨'); [cite: 455]
            [cite_start]createRoomControls.classList.add('hidden-by-url-param'); [cite: 455]
            [cite_start]mainActionButtons.classList.add('hidden-by-url-param'); [cite: 455]

            [cite_start]joinSection.classList.remove('hidden'); [cite: 455]
            [cite_start]roomCodeInput.value = roomCode; [cite: 456]
            [cite_start]roomCodeInput.readOnly = true; [cite: 456]
            [cite_start]nameInput.placeholder = 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê³  ì…ì¥í•˜ì„¸ìš”!'; [cite: 456]
            
            [cite_start]hintElement.classList.remove('hidden'); [cite: 456]
            [cite_start]gameOptionsSection.classList.add('hidden'); [cite: 456]
            if (document.activeElement !== nameInput) {
                [cite_start]nameInput.focus(); [cite: 457]
            [cite_start]} [cite: 457]

            [cite_start]showMessage(`ğŸ‰ ì´ˆëŒ€ ë§í¬ë¡œ ì ‘ì†í–ˆìŠµë‹ˆë‹¤! ë°© ì½”ë“œ: ${roomCode}\në‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê³  ì…ì¥í•˜ì„¸ìš”!`, 'success'); [cite: 458]
            [cite_start]const currentAutoJoinHandler = nameInput._autoJoinHandler; [cite: 458]
            if (currentAutoJoinHandler) {
                [cite_start]nameInput.removeEventListener('keypress', currentAutoJoinHandler); [cite: 459]
            }
            
            const newAutoJoinHandler = function(e) {
                if (e.key === 'Enter' && e.target.value.trim()) {
                    [cite_start]console.log('âš¡ Enter í‚¤ë¡œ ìë™ ì…ì¥ ì‹œë„'); [cite: 460]
                    joinRoom(roomCode);
                    nameInput.removeEventListener('keypress', newAutoJoinHandler);
                    nameInput._autoJoinHandler = null;
                }
            [cite_start]}; [cite: 461]
            [cite_start]nameInput.addEventListener('keypress', newAutoJoinHandler); [cite: 461]
            [cite_start]nameInput._autoJoinHandler = newAutoJoinHandler; [cite: 462]
            
            [cite_start]console.log('âœ… ìë™ ì…ì¥ UI ì„¤ì • ì™„ë£Œ'); [cite: 462]
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', () => {
            // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
            [cite_start]updateButtonStates(); [cite: 463]
            
            document.getElementById('mission-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    [cite_start]addMission(); [cite: 463]
                }
            [cite_start]}); [cite: 464]

            document.getElementById('room-code').addEventListener('input', function(e) {
                [cite_start]e.target.value = e.target.value.toUpperCase(); [cite: 464]
            [cite_start]}); [cite: 464]

            document.querySelectorAll('input[name="board-size"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    [cite_start]const newSize = parseInt(radio.value); [cite: 464]
                    [cite_start]gameState.boardSize = newSize; [cite: 465]
                    [cite_start]updateMissionsDisplay(); [cite: 465]
                });
            [cite_start]}); [cite: 465]

            [cite_start]loadMissions(); [cite: 466]
            // ë¯¸ì…˜ ì¶”ê°€ ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ ì„¤ì •
            [cite_start]document.getElementById('add-mission-btn').disabled = !gameState.roomCode; [cite: 466]
        });

        // í˜ì´ì§€ ì´íƒˆ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', async function() {
            if (gameState.roomRef && gameState.playerUID) {
                [cite_start]gameState.roomRef.off(); [cite: 467]
                // í”Œë ˆì´ì–´ê°€ ë°©ì„ ë‚˜ê°ˆ ë•Œë§Œ Firebaseì—ì„œ í”Œë ˆì´ì–´ ì •ë³´ ì‚­ì œ
                // í˜¸ìŠ¤íŠ¸ê°€ ë‚˜ê°ˆ ë•Œ ë°© ì „ì²´ë¥¼ ì‚­ì œí•˜ëŠ” ë¡œì§ì€ ì¶”ê°€í•˜ì§€ ì•ŠìŒ (ê²Œì„ì˜ ì¼ê´€ì„±ì„ ìœ„í•´)
                [cite_start]const playerRef = gameState.roomRef.child('players').child(gameState.playerUID); [cite: 467]
                [cite_start]const playerSnapshot = await playerRef.once('value'); [cite: 468]
                if (playerSnapshot.exists()) {
                    [cite_start]await playerRef.remove(); [cite: 468]
                    [cite_start]console.log(`í”Œë ˆì´ì–´ ${gameState.playerName}ì´(ê°€) ë°©ì„ ë‚˜ê°‘ë‹ˆë‹¤. UID: ${gameState.playerUID}`); [cite: 468]
                    // playerOrderUids ë°°ì—´ì—ì„œë„ í•´ë‹¹ UID ì œê±°
                    await gameState.roomRef.child('playerOrderUids').transaction((currentUids) => {
                        if (currentUids) {
                            [cite_start]return currentUids.filter(uid => uid !== gameState.playerUID); [cite: 469]
                        }
                        [cite_start]return []; [cite: 470]
                    [cite_start]}); [cite: 470]
                }
            }
        [cite_start]}); [cite: 471]
    </script>
</body>
</html>
